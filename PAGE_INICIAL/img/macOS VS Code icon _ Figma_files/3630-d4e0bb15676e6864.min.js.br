"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c536ced3-86cb-5375-82b8-c395b760a700")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3630],{988898:(e,t,n)=>{n.d(t,{$7:()=>o,Lp:()=>s,UD:()=>y,cA:()=>c,ik:()=>a,kK:()=>d,kX:()=>g,n0:()=>h,o1:()=>m,pG:()=>r,pN:()=>p,r3:()=>E,u6:()=>u,up:()=>i,xT:()=>f,xu:()=>S,xw:()=>l});let i="feed_composer--feedEditableTypeahead--jvsZg thread_comment_composer--editableTypeahead--9R6Yd text--fontPos13--xW8hS text--_fontBase--QdLsd",r="feed_composer--feedComposerBorder--k-qZ-",s="feed_composer--feedComposerMinimized--0NEpg",o="feed_composer--feedComposerUnfocused--LOiym feed_composer--feedComposer--Nbrsq",l="feed_composer--fileChip--XRac9",a="feed_composer--feedComposerFocused--u6-Rw feed_composer--feedComposer--Nbrsq",d="feed_composer--unifiedComposerContainer--Ic9sg thread_comment_composer--inputSectionWrapper--Bxyab",h="feed_composer--descriptionComposer--s0uuh feed_composer--descriptionComposerBase--3m1hj",c="feed_composer--commentDescriptionComposer--x8T69 feed_composer--descriptionComposerBase--3m1hj",p="feed_composer--composerTitle--qo0b-",u="feed_composer--composerTitleOverLimit--46wRP feed_composer--composerTitle--qo0b-",g="feed_composer--composerTitleEmpty--F9FJ- feed_composer--composerTitle--qo0b-",f="feed_composer--composerDescription--p5mkK",y="feed_composer--composerDescriptionEmpty--MNM0g feed_composer--composerDescription--p5mkK",m="feed_composer--actions--4DVzj thread_comment_composer--actions--7LRnN",S="feed_composer--leftComposerButtonGroup--dQdxH thread_comment_composer--leftComposerButtonGroup--6jQ3I",E="feed_composer--fileChipAttached--yUL6s feed_composer--fileChip--XRac9"},901765:(e,t,n)=>{n.d(t,{L:()=>r});var i=n(411855);function r(e,t,n){i.useEffect(()=>{let i=i=>{var r;let s=i.target;n&&!s.isConnected||(null==(r=e.current)?void 0:r.contains(s))||t()};return document.addEventListener("click",i),()=>{document.removeEventListener("click",i)}})}},229443:(e,t,n)=>{let i,r,s;n.d(t,{iX:()=>X});var o=n(411855),l=n(109388),a=n(728287),d=n(776250),h=n(609494),c=n(297666),p=n(517333),u=n(531664),g=n(966712),f=n(30637),y=n(939863),m=n(392592),S=n(975350),E=n(63397),C=n(801161),k=n(931828),T=n(259927),v=n(641717),b=n(516398),M=n(99506),I=n(531827),K=n(498606),A=n(400333),O=n(343348),_=n(377750),x=n(934480),B=n(733334),L=n(963462);function F(e,t){let n=(0,L.TE)(e),i=(0,x.UF)(t)[0].unicode,r=e.getCurrentContent().createEntity("EMOJI","IMMUTABLE",{text:t,unicode:i}).getLastCreatedEntityKey();return H(e,n,r,i,!1)}let H=(e,t,n,i,r)=>{let s=e.getSelection(),o=e.getCurrentContent(),{start:l,end:d}=t,h=s;null!=l&&null!=d&&(h=s.merge({anchorOffset:l,focusOffset:d}));let c=a.Modifier.replaceText(o,h,i,void 0,n),p=c.getSelectionAfter(),u=c.getLastBlock();u.getKey()===p.getStartKey()&&u.getKey()===p.getEndKey()&&u.getLength()===p.getStartOffset()&&u.getLength()===p.getEndOffset()&&(c=a.Modifier.replaceText(c,p,r?"":" ",void 0,void 0));let g=a.EditorState.push(e,c,"insert-fragment");return r?(0,L.aC)(g,"@"):a.EditorState.forceSelection(g,c.getSelectionAfter())};var w=n(527429);let R="editable_typeahead--mention--yPPjQ",P="editable_typeahead--hyperlink--JH0Ig",{hasCommandModifier:N}=a.KeyBindingUtil;var U=((i=U||{}).Bold="toggle-bold",i.Italic="toggle-italic",i.Strikethrough="toggle-strikethrough",i),D=((r=D||{}).UL="toggle-unordered-list",r.OL="toggle-ordered-list",r),j=((s=j||{}).ListBackspace="handle-list-backspace",s.Undo="handle-undo",s.Redo="handle-redo",s.Link="toggle-link",s);let G={BOLD:{fontWeight:600},HIGHLIGHT:{background:"var(--color-texthighlight, var(--bg-texthighlight))"}},W={"toggle-bold":"BOLD","toggle-italic":"ITALIC","toggle-strikethrough":"STRIKETHROUGH"},$={"toggle-unordered-list":"unordered-list-item","toggle-ordered-list":"ordered-list-item"},Q=new Set(["HIGHLIGHT",...Object.values(W)]);function Y(e){let t=[{strategy:L.Er,component:e=>o.createElement("span",{className:R,spellCheck:!1},e.children)},{strategy:L.f7,component:e=>o.createElement("span",{className:R,spellCheck:!1},e.children)},{strategy:L.cL,component:e=>o.createElement("span",{className:"editable_typeahead--emoji--vp6nb",spellCheck:!1},e.children)},{strategy:L.mi,component:e=>{let t="",n="";if(e.entityKey&&e.contentState){let i=e.contentState.getEntity(e.entityKey).getData();t=i.hyperlink,n=i.commentEditorType}return o.createElement("span",{className:P,spellCheck:!1,"data-tooltip-type":K.Ib.SPECIAL,"data-tooltip":K.MW.HYPERLINK_POPUP,"data-tooltip-show-above":!0,"data-tooltip-unconstrain-width":!0,"data-tooltip-can-edit":!0,"data-tooltip-url-string":t,"data-tooltip-interactive":!0,"data-tooltip-precise":!0,"data-tooltip-entity-key":e.entityKey,"data-tooltip-target-ref-key":n},e.children)}},{strategy:L.DL,component:e=>{let t=(0,w.V)(e.decoratedText);if(1!==t.length)return o.createElement(o.Fragment,null,e.children);let n=new URL(t[0].href).toString();return o.createElement("span",{className:P,spellCheck:!1,"data-tooltip-type":K.Ib.SPECIAL,"data-tooltip":K.MW.HYPERLINK_POPUP,"data-tooltip-show-above":!0,"data-tooltip-unconstrain-width":!0,"data-tooltip-can-edit":!1,"data-tooltip-url-string":n,"data-tooltip-interactive":!0,"data-tooltip-precise":!0,"data-testid":`implicit-hyperlink-${n}`},e.children)}}];return(null==e?void 0:e.enableHashtags)&&t.push({strategy:L.kI,component:e=>o.createElement("span",{className:R,spellCheck:!1},e.children)}),new a.CompositeDecorator(t)}class q{constructor(){this._isCanceled=!1,this._isEnabled=!0}isCanceled(){return!!this._isEnabled&&this._isCanceled}reset(){this._isEnabled=!1}cancel(){this._isEnabled&&(this._isCanceled=!0)}}class z extends Error{}async function J(e,t){let n=await e;if(t.isCanceled())throw t.reset(),new z;return t.reset(),n}let V=RegExp(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,"i");class X extends o.Component{constructor(e){super(e),this.TEST_ONLY_mentionsSearchPending=null,this.pendingMentionsSearch=null,this.ref=e=>{e&&!this.editorEl&&(this.editorEl=l.findDOMNode(e))},this.trackMentionSearchMetrics=(e,t,n)=>{let i=t.index,r=t.mentions?t.mentions.length:0;(0,d.sx)("at_mention_search_metrics",{did_click_through:n,search_text_length:e.length,selected_index:i,suggestions_length:r})},this.onChange=e=>{let t=this.state.editorState;this.setState({editorState:e});let n=t.getCurrentContent(),i=e.getCurrentContent(),r=t.getSelection(),s=e.getSelection();n!==i?this.onEditorContentChange(e):r!==s&&this.clearTypeahead("changed_selection")},this.onEditorContentChange=e=>{let t=(0,L.yN)(e);if(this.props.updateMessage([t,e]),this.props.enableHashtags&&void 0!==this.props.feedTitleBlockKey){let t=(0,L.u_)(e);if(null!==(0,L.KW)(e)||t){this.updateHashtags(e),t&&t.search&&!(0,L.Et)(e,this.props.feedTitleBlockKey)&&this.onHashtagSearchChange(t.search.substring(1));return}}let{search:n,type:i}=(0,L.TE)(e);null!=n?"MENTION"===i?this.onMentionSearchChange(n):"EMOJI"===i?this.onEmojiSearchChange(n):"COMPLETE_EMOJI"===i&&(this.clearTypeahead("completed_emoji_search"),this.insertEmojiFromString(n)):this.clearTypeahead("input_deleted")},this.hasTypeahead=()=>!!this.props.typeahead,this.insertMention=(e,t)=>{var n;let i=(0,L.Gm)(this.state.editorState);null==(n=this.state.contactsAnalytics)||n.trackResultClicked(i,t.index,t.mentions.length,e.id.startsWith("invite-")),this.trackMentionSearchMetrics(i,t,!0);let r=function(e,t){let n=e.getCurrentContent();if(t.id.startsWith("invite-")&&!("profile_handle"in t)){let i=n.createEntity("INVITE","IMMUTABLE",{mention:t}).getLastCreatedEntityKey(),r=(0,L.TE)(e);return H(e,r,i,(0,B.F)(t.handle)||"",!1)}let i=n.createEntity("MENTION","IMMUTABLE",{mention:t}).getLastCreatedEntityKey(),r=(0,L.TE)(e),s="profile_handle"in t?`@${t.profile_handle}`:t.handle;return H(e,r,i,(0,B.F)(s)||"",!1)}(this.state.editorState,e);"profile_handle"in e&&this.props.dispatch((0,E.Hx)(e)),this.onChange(r)},this.insertEmoji=e=>{let t=function(e,t){let n=_.il.getDefaultSkin(),i=n?`:skin-tone-${n}:`:"";return t.skins.length<2&&(i=""),F(e,`:${t.id}:`+i)}(this.state.editorState,e);this.onChange(t)},this.insertSuggestion=e=>{let t=function(e,t){let n=e.getCurrentContent().createEntity("SUGGESTION","IMMUTABLE",{suggestion:t}).getLastCreatedEntityKey(),i=(0,L.TE)(e);return H(e,i,n,t.suggestionInsert,t.suggestionInsert.includes("@"))}(this.state.editorState,e.suggestedComments[e.index]);this.onChange(t)},this.insertHashtag=e=>{let t=e.hashtags[e.index],n=function(e,t){let n=(0,L.u_)(e);if(!n||!n.search)return e;let i=(0,L.KW)(e);return null===i&&(i=e.getCurrentContent().createEntity("HASHTAG","MUTABLE").getLastCreatedEntityKey()),H(e,n,i,t,!1)}(this.state.editorState,`#${t.text}`);this.onChange(n)},this.insertFirstPendingUserInvite=e=>{var t;if(null==(t=e[0].user)?void 0:t.email){let t=function(e,t){let n=e.getCurrentContent().createEntity("INVITE","IMMUTABLE",{mention:{email:t.user.email,id:`invite-${t.id}`}}).getLastCreatedEntityKey(),i=(0,L.TE)(e);return t.user.email?H(e,i,n,t.user.email,!1):e}(this.state.editorState,e[0]);this.onChange(t)}},this.insertEmojiFromString=e=>{let t=F(this.state.editorState,e);this.onChange(t)},this.updateHashtags=e=>{let t=function(e,t){let n=(0,L.pn)(e),i=e.getCurrentContent(),r=(0,L.d8)(e),s=e.getSelection();if(r.findEntityRanges(e=>{let t=e.getEntity();return null!==t&&"HASHTAG"===i.getEntity(t).getType()},(t,n)=>{i=a.Modifier.applyEntity(i,s.merge({anchorOffset:t,focusOffset:n}),null),e=a.EditorState.push(e,i,"apply-entity")}),r.getKey()===t)return e;Array.from(n).forEach(t=>{let n=(i=i.createEntity("HASHTAG","MUTABLE")).getLastCreatedEntityKey(),r=s.merge({anchorOffset:t.start,focusOffset:t.end});i=a.Modifier.applyEntity(i,r,n),e=a.EditorState.push(e,i,"apply-entity")});let o=s.merge({anchorOffset:s.getEndOffset(),anchorKey:s.getEndKey(),focusOffset:s.getEndOffset(),focusKey:s.getEndKey()});return e=a.EditorState.forceSelection(e,o)}(e,this.props.feedTitleBlockKey);this.setState({editorState:t});let n=(0,L.yN)(t);this.props.updateMessage([n,t])},this.onInsert=()=>{let e=this.props.typeahead;e&&"mentions"===e.type&&e.mentions[e.index]?this.insertMention(e.mentions[e.index],e):e&&"emojis"===e.type&&e.emojis[e.index]?this.insertEmoji(e.emojis[e.index]):e&&"suggestions"===e.type?this.insertSuggestion(e):this.props.enableHashtags&&e&&"hashtags"===e.type&&this.insertHashtag(e)},this.assignEditorOnInsertClear=()=>{this.props.editorOnInsert(this.onInsert),this.props.editorOnClear(()=>this.clearTypeahead("editor_clear"))},this.newMentionsSearch=async e=>{this.pendingMentionsSearch&&this.pendingMentionsSearch.cancel(),this.pendingMentionsSearch=new q;try{return{result:await J((0,I.fG)(e,this.props.mentionables,!this.props.isProtoView&&this.props.figmaEditorType===M._Y.DESIGN),this.pendingMentionsSearch),canceled:!1}}catch(e){if(e instanceof z)return{result:null,canceled:!0};throw e}},this.onMentionSearchChange=(0,c.s)(async e=>{var t;let n=this.newMentionsSearch(e);(0,f.Lg)()&&(this.TEST_ONLY_mentionsSearchPending=n);let{result:i,canceled:r}=await n;r||(i?(null==(t=this.state.contactsAnalytics)||t.trackQueryResult(e,(null==i?void 0:i.mentions.length)??0),this.props.dispatch(S.We(i))):this.props.dispatch(S.We({type:"mentions",mentions:[],index:0,maxMentions:0,search:e})),this.props.onUpdateTextArea(this.state.editorState))},300),this.onEmojiSearchChange=e=>{this.props.dispatch(S.We((0,I.oQ)(e))),this.props.onUpdateTextArea(this.state.editorState)},this.onHashtagSearchChange=(0,c.s)(async e=>{if(!this.props.hashtagSearchLibrary)return;let t=await (0,I.$V)(e,this.props.hashtagSearchLibrary);this.props.dispatch(S.We(t)),this.props.onUpdateTextArea(this.state.editorState)}),this.clearTypeahead=e=>{var t,n;this.pendingMentionsSearch&&this.pendingMentionsSearch.cancel(),null==(t=this.state.contactsAnalytics)||t.endSession(e),this.hasTypeahead()&&((null==(n=this.props.typeahead)?void 0:n.type)==="suggestions"?"editor_clear"===e?this.props.dispatch(S.UU({force:!0})):"changed_selection"!==e&&this.props.dispatch(S.We(null)):this.props.dispatch(S.We(null)))},this._handleBeforeInput=(e,t)=>{if(this.props.maxCommentLength&&t.getCurrentContent().getPlainText("").length>=this.props.maxCommentLength)return"handled";let n=(0,L.Wt)(t,e);if("ordered-list-item"===n||"unordered-list-item"===n)return t=(0,L.q7)(t,n),this.onChange(t),"handled";let i=(0,L.XM)(t,e);return i?(t=(0,L.oP)(t,e,i),this.onChange(t),"handled"):"not-handled"},this.selectAll=()=>{let e=this.state.editorState.getSelection(),t=this.state.editorState.getCurrentContent(),n=e.merge({anchorKey:t.getFirstBlock().getKey(),anchorOffset:0,focusOffset:t.getLastBlock().getText().length,focusKey:t.getLastBlock().getKey()});this.setState({editorState:a.EditorState.forceSelection(this.state.editorState,n)})},this.hasFocus=()=>this.state.editorState.getSelection().getHasFocus(),this.focus=(e=!0)=>{let t=this.state.editorState.getSelection();t.getHasFocus()?this.props.onFocus():e?setTimeout(()=>{this.props.moveFocusToStartOnMount?this.setState({editorState:(0,L.jM)(this.state.editorState)}):this.setState({editorState:a.EditorState.moveFocusToEnd(this.state.editorState)}),this.onFocus()},0):this.setState({editorState:a.EditorState.forceSelection(this.state.editorState,t)})},this.moveFocusBefore=()=>{let e=(0,L.d8)(this.state.editorState),t=this.state.editorState.getCurrentContent().getBlockBefore(e.getKey()),n=this.state.editorState.getSelection();if(t){let e=n.merge({anchorKey:t.getKey(),anchorOffset:t.getLength(),focusKey:t.getKey(),focusOffset:t.getLength()});this.setState({editorState:a.EditorState.forceSelection(this.state.editorState,e)})}},this.isAllSelected=()=>{let e=this.state.editorState;return e.isSelectionAtStartOfContent()&&e.isSelectionAtEndOfContent()},this.onNavigationKeyDown=e=>(e.stopPropagation(),this.hasTypeahead())?(e.preventDefault(),null):(0,a.getDefaultKeyBinding)(e),this.handleEscape=()=>{this.hasTypeahead()||this.props.dropdownShown&&this.props.dropdownShown.type===T.VJ||this.props.editingComment&&"comment-editor-reply"===this.props.editorType||!this.editorEl||(this.editorEl.blur(),this.props.onCancel())},this.handleReturn=(e,t)=>{e.stopPropagation();let n=this.state.editorState.getCurrentContent().getPlainText(),i=/^\s+$/,r=!!n&&!i.test(n),s=t.getSelection(),o=t.getCurrentContent().getBlockForKey(s.getStartKey());if(this.hasTypeahead())return e.preventDefault(),"handled";if(this.props.blockKeyToType&&Object.values(this.props.blockKeyToType).includes(o.getType())){let e=a.Modifier.splitBlock(t.getCurrentContent(),t.getSelection()),n=(t=a.EditorState.push(t,e,"split-block")).getCurrentContent().getBlockAfter(o.getKey());return e=a.Modifier.setBlockType(e,s.merge({anchorKey:null==n?void 0:n.getKey(),anchorOffset:0,focusKey:null==n?void 0:n.getKey(),focusOffset:0}),"unstyled"),t=a.EditorState.set(t,{allowUndo:!1}),t=a.EditorState.push(t,e,"change-block-type"),t=a.EditorState.set(t,{allowUndo:!0}),this.onChange(t),"handled"}if(r){if(e.altKey||e.metaKey)return e.preventDefault(),this.props.onSubmit(),"handled";if(e.shiftKey||e.ctrlKey){let e=(0,L.XM)(t,"\n");if(e){t=(0,L.oP)(t,"",e);let n=a.Modifier.splitBlock(t.getCurrentContent(),t.getSelection());return t=a.EditorState.push(t,n,"split-block"),this.onChange(t),"handled"}}else if(s.isCollapsed()&&["unordered-list-item","ordered-list-item"].includes(o.getType())){if(i.test(o.getText())){let e=a.Modifier.setBlockType(t.getCurrentContent(),s,"unstyled");t=a.EditorState.push(t,e,"change-block-type")}else{let e=a.Modifier.splitBlock(t.getCurrentContent(),s);t=a.EditorState.push(t,e,"split-block")}return this.onChange(t),"handled"}else if(this.props.enableHashtags&&null!==(0,L.KW)(t)){let e=a.Modifier.splitBlock(t.getCurrentContent(),t.getSelection()),n=(t=a.EditorState.push(t,e,"split-block")).getCurrentContent().getBlockAfter(o.getKey());return null==n||n.findEntityRanges(t=>{let n=t.getEntity();return null!==n&&"HASHTAG"===e.getEntity(n).getType()},(i,r)=>{e=a.Modifier.applyEntity(e,s.merge({anchorKey:null==n?void 0:n.getKey(),anchorOffset:i,focusKey:null==n?void 0:n.getKey(),focusOffset:r}),null),t=a.EditorState.push(t,e,"apply-entity")}),t=a.EditorState.forceSelection(t,s.merge({anchorKey:null==n?void 0:n.getKey(),anchorOffset:0,focusKey:null==n?void 0:n.getKey(),focusOffset:0})),this.onChange(t),"handled"}else if(this.props.submitOnEnter)return e.preventDefault(),this.props.onSubmit(),"handled"}return"not-handled"},this.handlePastedFiles=e=>(this.props.onFilePaste&&this.props.onFilePaste(e),"handled"),this.handlePastedText=(e,t,n)=>{if(!e)return"handled";let i=n.getSelection(),r=n.getCurrentContent();if(!(0,L.c9)(n)&&e.match(V)&&(0,w.$)((0,A.xT)(e))){for(let e of(i.getIsBackward()&&(i=i.merge({anchorKey:i.getFocusKey(),anchorOffset:i.getFocusOffset(),focusKey:i.getAnchorKey(),focusOffset:i.getAnchorOffset(),isBackward:!1})),Object.values(W)))r=a.Modifier.removeInlineStyle(r,i,e);let t=(r=r.createEntity("HYPERLINK","MUTABLE",{hyperlink:e,commentEditorType:this.props.editorType})).getLastCreatedEntityKey(),s=a.Modifier.applyEntity(r,i,t);n=a.EditorState.push(n,s,"apply-entity");let o=i.merge({anchorOffset:i.getEndOffset(),anchorKey:i.getEndKey(),focusOffset:i.getEndOffset(),focusKey:i.getEndKey()});return n=a.EditorState.forceSelection(n,o),this.onChange(n),"handled"}if((0,g.kc)().comments_html_paste&&t){let e=(0,L._S)(t),i=a.Modifier.replaceWithFragment(n.getCurrentContent(),n.getSelection(),e.getBlockMap()),r=a.EditorState.push(n,i,"insert-fragment");return this.onChange(r),"handled"}{let t=a.Modifier.replaceWithFragment(n.getCurrentContent(),n.getSelection(),a.ContentState.createFromText(e).getBlockMap()),i=a.EditorState.push(n,t,"insert-fragment");return this.onChange(i),"handled"}},this.onSubmitHyperlink=e=>{let t=this.state.editorState;if(this.state.hyperlinkState){let n=this.state.hyperlinkState.selectionToHyperlink,i=(0,A.xT)(e);if((0,w.$)(i)){if(n.isCollapsed()){let e=t.getCurrentContent();e=a.Modifier.insertText(e,n,i),t=a.EditorState.push(t,e,"insert-characters");let r=n.getStartOffset();n=(0,L.Ji)(t,{start:r,end:r+i.length})}let e=t.getCurrentContent();for(let t of Q)e=a.Modifier.removeInlineStyle(e,n,t);if(t=a.EditorState.push(t,e,"change-inline-style"),this.state.hyperlinkState.entityKey){e=e.replaceEntityData(this.state.hyperlinkState.entityKey,{hyperlink:i,commentEditorType:this.props.editorType});let r=a.Modifier.applyEntity(e,n,this.state.hyperlinkState.entityKey);t=a.EditorState.push(t,r,"apply-entity")}else{let r=(e=e.createEntity("HYPERLINK","MUTABLE",{hyperlink:i,commentEditorType:this.props.editorType})).getLastCreatedEntityKey(),s=a.Modifier.applyEntity(e,n,r);t=a.EditorState.push(t,s,"apply-entity")}}else{let e=t.getCurrentContent();e=a.Modifier.removeInlineStyle(e,n,"HIGHLIGHT"),t=a.EditorState.push(t,e,"change-inline-style"),this.props.dispatch(m.F.enqueue({message:(0,y.t)("hyperlink.invalid_link_plain")}))}this.onChange(t),this.setState({hyperlinkState:null})}},this.onFocus=()=>{var e;if(this.assignEditorOnInsertClear(),this.props.setIsEditorFocused(!0),this.focus(!this.props.maintainSelectionOnFocus),(null==(e=this.state.hyperlinkState)?void 0:e.selectionToHyperlink)&&!this.props.hyperlinkLocation){let e=this.state.editorState.getCurrentContent(),t=this.state.editorState;e=a.Modifier.removeInlineStyle(e,this.state.hyperlinkState.selectionToHyperlink,"HIGHLIGHT"),t=a.EditorState.push(t,e,"change-inline-style"),this.onChange(t),this.setState({hyperlinkState:null})}},this.onBlur=()=>{var e;let{typeahead:t}=this.props;if(t&&"mentions"===t.type&&t.mentions[t.index]){null==(e=this.state.contactsAnalytics)||e.endSession("input_blurred");let n=(0,L.Gm)(this.state.editorState);this.trackMentionSearchMetrics(n,t,!1)}this.props.setIsEditorFocused(!1)},this.handleKeyCommand=(e,t)=>{if(W[e]){let n=W[e],i=a.RichUtils.toggleInlineStyle(t,n);if(i)return this.onChange(i),"handled"}else if($[e]){let n=$[e],i=a.RichUtils.toggleBlockType(t,n);if(i)return this.onChange(i),"handled"}else if("handle-undo"===e){t=a.EditorState.undo(t);let e=(0,L.d8)(t).getText();for(let n of L.Bm){if(e.trim()===n){let n=e.length;t=a.EditorState.forceSelection(t,(0,L.Ji)(t,{start:n,end:n}))}if("1."===e.trim()){let n=e.length;t=a.EditorState.forceSelection(t,(0,L.Ji)(t,{start:n,end:n}))}}return this.onChange(t),"handled"}else if("handle-redo"===e){let e=(0,L.d8)(t).getText();t=a.EditorState.redo(t);let n=(0,L.d8)(t).getText();for(let i of L.Bm)if(e.trim()===i||n.trim()===i){let e=n.length;return t=a.EditorState.forceSelection(t,(0,L.Ji)(t,{start:e,end:e})),this.onChange(t),"handled"}if("1."===e.trim()||"1."===n.trim()){let e=n.length;return t=a.EditorState.forceSelection(t,(0,L.Ji)(t,{start:e,end:e})),this.onChange(t),"handled"}return this.onChange(t),"handled"}else if("handle-list-backspace"===e){let e=a.Modifier.setBlockType(t.getCurrentContent(),t.getSelection(),"unstyled"),n=a.EditorState.push(t,e,"change-block-type");return this.onChange(n),"handled"}else if("toggle-link"===e){let{selection:e,entityKey:n}=(0,L.M1)(t);t=a.EditorState.forceSelection(t,e),this.onChange(t);let i=(0,L.L5)();if(i&&this.props.setHyperlinkLocation&&this.props.setHyperlinkEditorRef)return this.setHyperlinkEditorState(t,i,n),"handled"}return"not-handled"},this.getActiveHyperlinkForCurrentSelection=()=>{var e;return(null==(e=this.state.hyperlinkState)?void 0:e.entityKey)?this.state.editorState.getCurrentContent().getEntity(this.state.hyperlinkState.entityKey).getData().hyperlink:""},this.onRemoveHyperlink=()=>{var e;if(null==(e=this.state.hyperlinkState)?void 0:e.entityKey){let e=this.state.editorState,t=a.Modifier.applyEntity(this.state.editorState.getCurrentContent(),this.state.hyperlinkState.selectionToHyperlink,null);this.onChange(a.EditorState.push(e,t,"apply-entity"))}},this.keyBindingFn=e=>{if((0,b.fB)(e))return null;if("Escape"===e.key&&!this.props.delegateEscapeHandling)return this.handleEscape(),null;if("Backspace"===e.key){let e=(0,L.d8)(this.state.editorState);if(("ordered-list-item"===e.getType()||"unordered-list-item"===e.getType())&&(0,L.wT)(this.state.editorState))return"handle-list-backspace"}if("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key||"Tab"===e.key)return this.onNavigationKeyDown(e);if(N(e)){e.stopPropagation();let t="k"===e.key&&!(0,g.kc)().qa_v2||e.shiftKey&&"u"===e.key&&(0,g.kc)().qa_v2;if("z"===e.key&&!e.shiftKey)return"handle-undo";if("z"===e.key&&e.shiftKey)return"handle-redo";if("b"===e.key)return"toggle-bold";if("i"===e.key)return"toggle-italic";if(t)return"toggle-link";if(e.shiftKey&&"x"===e.key)return"toggle-strikethrough";if(e.shiftKey&&"8"===e.key)return"toggle-unordered-list";if(e.shiftKey&&"7"===e.key)return"toggle-ordered-list"}return e.stopPropagation(),(0,a.getDefaultKeyBinding)(e)},this.onMouseDown=e=>{e.stopPropagation()},this.onContextMenu=e=>{p.eD||e.stopPropagation()};let t=(0,v.Ty)(e.currentOrgId??null,e.user??null,e.currentOrgUsers),n=(0,v.pP)(e.currentOrgId,e.openFileTeamId,t),i=e.openFileTeamId??null,r=null,s=Y({enableHashtags:this.props.enableHashtags});r=this.props.messageMeta?(0,L.Aw)(this.props.messageMeta,s,this.props.editorType,this.props.existingPendingMentions):a.EditorState.createEmpty(s),this.state={editorState:r,contactsAnalytics:new v.yO(v.I2,e.openFileKey,n,e.currentOrgId,i),hyperlinkState:null}}async componentDidMount(){if(this.assignEditorOnInsertClear(),this.props.mountInputFocused){let e=this.props.moveFocusToStartOnMount?(0,L.jM)(this.state.editorState):a.EditorState.moveFocusToEnd(this.state.editorState);if(this.props.setIsEditorFocused(!0),this.onChange(e),(!this.props.hasMentionedPendingUserInvite||!this.props.hasMentionedPendingUserInviteTwice)&&this.props.pendingUserInvites&&this.props.pendingUserInvites.length>0){if(1===this.props.pendingUserInvites.length)this.insertFirstPendingUserInvite(this.props.pendingUserInvites);else{let{result:t,canceled:n}=await this.newMentionsSearch("");n||setTimeout(()=>{this.props.dispatch(S.We(t)),this.onChange(e),this.props.onUpdateTextArea(this.state.editorState)},180)}}}this.props.editorRef&&this.props.editorType&&this.props.dispatch(C.pP({targetKey:this.props.editorType,targetRef:this.props.editorRef})),this.props.updateMessageOnMount&&this.onEditorContentChange(this.state.editorState)}componentDidCatch(e){"Node.removeChild: The node to be removed is not a child of this node"===e.message&&this.forceUpdate()}componentDidUpdate(e){var t,n,i,r,s;let o=this.state.editorState;if(!(0,h.Wf)(this.props.messageMeta,e.messageMeta)||this.props.existingPendingMentions!==e.existingPendingMentions){let s=(0,L.yN)(this.state.editorState);if(!(0,h.Wf)(s,this.props.messageMeta)||this.props.existingPendingMentions!==e.existingPendingMentions){let e=Y({enableHashtags:this.props.enableHashtags});o=(0,L.Aw)(this.props.messageMeta,e,this.props.editorType,this.props.existingPendingMentions),o=this.state.editorState.getSelection().getHasFocus()?a.EditorState.moveFocusToEnd(o):a.EditorState.moveSelectionToEnd(o),this.onChange(o)}let l=(null==(t=this.props.pendingUserInvites)?void 0:t.length)===1?o.getCurrentContent().getPlainText()===`${null==(n=this.props.pendingUserInvites[0].user)?void 0:n.email} `:""===o.getCurrentContent().getPlainText();(!this.props.hasMentionedPendingUserInvite||!this.props.hasMentionedPendingUserInviteTwice)&&((null==(i=this.props.pendingUserInvites)?void 0:i.length)??0)>0&&(null==(r=this.props.user)?void 0:r.id)&&!this.props.typeahead&&l&&setTimeout(async()=>{var e,t,n;if(this.props.onUpdateTextArea(this.state.editorState),(null==(e=this.props.pendingUserInvites)?void 0:e.length)===1)this.props.dispatch(S.We((0,O.tI)({index:-1,userId:null==(n=null==(t=this.props)?void 0:t.user)?void 0:n.id})));else{let e=await (0,I.fG)("",this.props.mentionables,!this.props.isProtoView&&this.props.figmaEditorType===M._Y.DESIGN);this.props.dispatch(S.We(e))}},180)}if(e.mentionables!==this.props.mentionables&&this.onEditorContentChange(o),this.props.initMention&&!e.initMention){let e;let t=o;e=t.getSelection().size>0?a.Modifier.replaceText(t.getCurrentContent(),t.getSelection(),"@"):a.Modifier.insertText(t.getCurrentContent(),t.getSelection(),"@"),this.setState({editorState:a.EditorState.push(o,e,"insert-fragment")})}if(this.props.blockKeyToType&&(!(0,h.Wf)(this.props.messageMeta,e.messageMeta)||!(0,u.c2)(this.props.blockKeyToType,e.blockKeyToType))){let e=o.getSelection(),t=o.getCurrentContent().getBlockMap();for(let e of o.getCurrentContent().getBlocksAsArray()){let n=e.merge({type:this.props.blockKeyToType[e.getKey()]||e.getType(),data:e.getData()});t=t.set(e.getKey(),n)}let n=o.getCurrentContent().merge({blockMap:t,selectionAfter:e});o=a.EditorState.set(o,{allowUndo:!1}),o=a.EditorState.push(o,n,"change-block-type"),o=a.EditorState.set(o,{allowUndo:!0}),this.onChange(o)}if(!e.typeahead&&this.props.typeahead&&"mentions"===this.props.typeahead.type){let{search:e}=(0,L.TE)(o);""===e&&(null==(s=this.state.contactsAnalytics)||s.trackQueryResult("",this.props.typeahead.mentions.length)),this.props.dispatch(S.Qe())}}componentWillUnmount(){var e,t;this.props.setIsEditorFocused(!1);let n=this.props.pendingUserInvites&&this.props.pendingUserInvites.length>0;n&&!this.props.hasMentionedPendingUserInvite?(this.props.dispatch(k.b({has_mentioned_pending_user_invite:!0})),null==(t=(e=this.props).setPendingUserInvitesAtom)||t.call(e,[])):n&&this.props.hasMentionedPendingUserInvite&&!this.props.hasMentionedPendingUserInviteTwice&&this.props.dispatch(k.b({has_mentioned_pending_user_invite_twice:!0}))}editHyperlinkFromTooltip(e,t){let n=this.state.editorState.getCurrentContent(),i="",r=0,s=0;if(n.getBlockMap().every((t,n)=>(t&&t.findEntityRanges(t=>t.getEntity()===e,(e,t)=>{i=n||"",r=e,s=t}),!i)),this.props.dispatch(C.jD()),""===i)return;let o=this.state.editorState.getSelection().merge({anchorKey:i,focusKey:i,anchorOffset:r,focusOffset:s});o=(0,L.Qo)(this.state.editorState,o,e);let l=a.EditorState.forceSelection(this.state.editorState,o);this.onChange(l),t&&this.setHyperlinkEditorState(l,t,e)}setHyperlinkEditorState(e,t,n){if(this.props.setHyperlinkLocation&&this.props.setHyperlinkEditorRef&&this.props.editorRef){this.setState({hyperlinkState:{selectionToHyperlink:e.getSelection(),entityKey:n}}),this.props.setHyperlinkLocation(t),this.props.setHyperlinkEditorRef(this.props.editorRef);let i=a.Modifier.applyInlineStyle(e.getCurrentContent(),e.getSelection(),"HIGHLIGHT"),r=a.EditorState.push(e,i,"change-inline-style");this.onChange(r)}}render(){let e="editable_typeahead--wrapperBase--rwdvD";e=this.props.className?e+" "+this.props.className:e+" editable_typeahead--wrapperDefault--G1MoY";let t=(0,L.FA)(this.state.editorState);return o.createElement("div",{className:e,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.onFocus,onClick:this.onFocus,"data-testid":"editable-typeahead"},o.createElement(a.Editor,{editorState:this.state.editorState,placeholder:t?this.props.placeholderText:void 0,onChange:this.onChange,handleReturn:this.handleReturn,keyBindingFn:this.keyBindingFn,handleKeyCommand:this.handleKeyCommand,spellCheck:!0,onBlur:this.onBlur,ref:this.ref,handleBeforeInput:this._handleBeforeInput,tabIndex:this.props.tabIndex||0,handlePastedText:this.handlePastedText,handlePastedFiles:this.handlePastedFiles,customStyleMap:G,readOnly:this.props.readOnly,blockStyleFn:this.props.blockStyleFn}))}}X.displayName="EditableTypeahead"},963462:(e,t,n)=>{n.d(t,{Aw:()=>et,Bm:()=>k,DL:()=>b,Er:()=>M,Et:()=>B,FA:()=>j,Gm:()=>O,Ji:()=>$,KW:()=>L,L5:()=>R,M1:()=>P,Qo:()=>U,TE:()=>x,Wt:()=>J,XM:()=>z,_S:()=>eo,aC:()=>_,c9:()=>D,cL:()=>T,d8:()=>W,f7:()=>I,jM:()=>ei,kI:()=>K,mi:()=>v,oP:()=>V,pn:()=>H,q7:()=>X,u_:()=>F,wT:()=>G,yN:()=>Z});var i=n(728287),r=n(751467),s=n.n(r),o=n(511617),l=n(609494),a=n(934480),d=n(733334),h=n(96328),c=n(400333),p=n(527429);let u={BOLD:"b",ITALIC:"i",STRIKETHROUGH:"s"},g={b:"BOLD",i:"ITALIC",s:"STRIKETHROUGH"},f={BOLD:[{char:"*",sequence:"**"},{char:"_",sequence:"__"}],ITALIC:[{char:"*",sequence:"*"},{char:"_",sequence:"_"}],STRIKETHROUGH:[{char:"~",sequence:"~"}]},y=/:([0-9A-Za-z-_+]+)$/,m=/(:[0-9A-Za-z-_+]+:)$/,S=/(#[0-9A-Za-z\-_]*)$/,E=/^(#[0-9A-Za-z\-_]*)/,C=/\B(#[0-9A-Za-z\-_]+)\b/g,k=new Set(["*","-","+"]);function T(e,t,n){return A(e,t,n,"EMOJI")}function v(e,t,n){return A(e,t,n,"HYPERLINK")}function b(e,t){let n=e.getText();for(let i of(0,p.V)(n).filter(t=>{for(let n=t.start;n<t.end;n++)if(e.getEntityAt(n))return!1;return!0}))t(i.start,i.end)}function M(e,t,n){return A(e,t,n,"MENTION")}function I(e,t,n){return A(e,t,n,"INVITE")}function K(e,t,n){return A(e,t,n,"HASHTAG")}let A=(e,t,n,i)=>{e.findEntityRanges(e=>(function(e,t,n){return null!==t&&e.getEntity(t).getType()===n})(n,e.getEntity(),i),t)};function O(e){let t=e.getSelection(),n=e.getCurrentContent(),i=t.getAnchorKey(),r=n.getBlockForKey(i),s=t.getAnchorOffset(),o=w(r.getText().substring(0,s));return null!==o?o.search:""}function _(e,t){let n=e.getCurrentContent().getBlockMap().toArray(),r=null;for(let e of n){let n=e.getText().indexOf(t);if(-1!==n){r={blockKey:e.getKey(),position:n+1};break}}if(r){let t=new i.SelectionState({anchorKey:r.blockKey,anchorOffset:r.position,focusKey:r.blockKey,focusOffset:r.position});return i.EditorState.forceSelection(e,t)}return e}function x(e){let t,n,i,r;let s=e.getSelection(),o=e.getCurrentContent(),h=s.getAnchorKey(),c=o.getBlockForKey(h),p=s.getAnchorOffset(),u=o.getBlocksAsArray(),g=Z(e),f=c.getText().substring(0,p),S=f.match(y),E=f.match(m),C=w(f);if(C){let e=function(e,t,n,i,r){let{token:s}=function e(t,n){var i,r,s,o;let l=0;for(let a=0;a<n.length;a++){if(null==(i=n[a].children)?void 0:i.length){let{lengthOfText:i,token:r}=e(t-l,n[a].children);if((l+=i)>t)return{lengthOfText:l,token:r}}else n[a].t?l+=(null==(r=n[a].t)?void 0:r.replace(/\n/g,"").length)||0:l+=(null==(o=(0,d.F)(null==(s=n[a].user_annotated)?void 0:s.handle))?void 0:o.length)||0;if((l+="profile_id"in n[a]?1:0)>t)return{lengthOfText:l,token:n[a]}}return{lengthOfText:l,token:null}}(function(e,t,n,i){let r=0;for(let n=0;n<e.length&&e[n]!==t;++n)r+=e[n].getText().replace(/\n/g,"").length;return r+(n-(i.match(/\n/g)||[]).length)}(e,t,n,r),i);return s}(u,c,C.index,g,f);C=e&&(0,l.l5)(e)===l.vj.PLAIN_TEXT?C:null}return C?(t="MENTION",n=C.search,i=C.index,r=p):S?(t="EMOJI",n=S[1],i=S.index,r=p):E&&(0,a.xM)(E[1])&&(t="COMPLETE_EMOJI",n=E[1],i=E.index,r=p),{type:t,search:n,start:i,end:r}}function B(e,t){return e.getSelection().getAnchorKey()===t}function L(e){let t=e.getSelection(),n=e.getCurrentContent(),i=t.getAnchorKey(),r=n.getBlockForKey(i),s=t.getAnchorOffset(),o=r.getEntityAt(s);return o&&"HASHTAG"===n.getEntity(o).getType()?o:null}function F(e){let t=e.getSelection(),n=e.getCurrentContent(),i=t.getAnchorKey(),r=n.getBlockForKey(i),s=t.getAnchorOffset(),o=r.getText().substring(0,s),l=r.getText().substring(s),a=o.match(S),d=l.match(E);if(d&&void 0!==d.index)return{type:"HASHTAG",search:void 0,start:void 0,end:void 0};if(a&&void 0!==a.index){let e=a.index,t=r.getText().substring(e).match(E);if(t&&void 0!==t.index){let n=e+t.index;return{type:"HASHTAG",search:t[1],start:n,end:n+t[1].length}}}}function H(e){let t=e.getSelection(),n=e.getCurrentContent(),i=t.getAnchorKey();return Array.from(n.getBlockForKey(i).getText().matchAll(C)).filter(e=>void 0!==e.index).map(e=>({type:"HASHTAG",search:e[1],start:e.index,end:e.index+e[1].length}))}function w(e){let t;let n=0,i=0;-1!==e.lastIndexOf("\n")&&(i=e.lastIndexOf("\n")+1,e=e.substring(i));let r=e.lastIndexOf("@");if(-1!==r){if(t=e.substring(r+1),n=r," "===t.substring(0,1)||t.length>100)return null;let i=e.substring(0,r),s=i.lastIndexOf("@");if(-1!==s){let r=e.substring(s+1);if(-1===r.indexOf(" ")){if(0!==s&&" "!==i[s-1])return null;t=r,n=s}}else if(0!==r&&![" ","[","{","("].includes(e[r-1]))return null}return null!=t?{search:t,index:n+=i}:null}function R(){let e=window.getSelection();if(e&&e.rangeCount>0){let t=e.getRangeAt(0).getBoundingClientRect();return(0,o.E)(t)}return null}function P(e){var t;let n=e.getSelection(),i=null;if((t=n).getStartKey()===t.getEndKey()){let t=W(e),r=[];if(t.findEntityRanges(t=>{let n=t.getEntity();return null!==n&&"HYPERLINK"===e.getCurrentContent().getEntity(n).getType()},(e,t)=>{r.push({start:e,end:t})}),r.length<1)return{selection:n,entityKey:i};let s={start:n.getStartOffset(),end:n.getEndOffset()};for(let o of r)if(s.start>=o.start&&s.end<=o.end){n=$(e,o),i=t.getEntityAt(o.start);break}}return i&&(n=U(e,n,i)),{selection:n,entityKey:i}}function N(e,t,n,i){let r=t.getEntityAt(n);if(!r)return!1;let s=e.getEntity(r);return"HYPERLINK"===s.getType()&&s.getData().hyperlink===i}function U(e,t,n){let i=e.getCurrentContent(),r=i.getEntity(n);if(!r||"HYPERLINK"!==r.getType())return t;let s=r.getData().hyperlink,o=i.getBlockForKey(t.getStartKey()),l=t.getStartOffset(),a=o,d=l-1;e:for(let e=0;e<i.getBlocksAsArray().length&&a;e++){for(;d>=0;d--){if(!N(i,a,d,s))break e;o=a,l=d}d=((null==(a=i.getBlockBefore(a.getKey()))?void 0:a.getLength())||0)-1}let h=i.getBlockForKey(t.getEndKey()),c=t.getEndOffset();a=h,d=c+1;e:for(let e=0;e<i.getBlocksAsArray().length&&a;e++){for(;d<=a.getLength();d++){if(!N(i,a,d-1,s))break e;h=a,c=d}a=i.getBlockAfter(a.getKey()),d=1}return t.merge({anchorOffset:l,anchorKey:o.getKey(),focusOffset:c,focusKey:h.getKey()})}function D(e){let t=e.getSelection();return t.getAnchorKey()===t.getFocusKey()&&t.getAnchorOffset()===t.getFocusOffset()}function j(e){let t=e.getCurrentContent();return!t.hasText()&&"unstyled"===t.getBlockMap().first().getType()}function G(e){return!!D(e)&&0===e.getSelection().getStartOffset()}function W(e){let t=e.getSelection().getAnchorKey();return e.getCurrentContent().getBlockForKey(t)}function $(e,t){let n=W(e);return i.SelectionState.createEmpty(n.getKey()).merge({anchorOffset:t.start,focusOffset:t.end})}function Q(e,t,n){let r=$(e,t);return i.Modifier.replaceText(e.getCurrentContent(),r,n)}let Y=e=>{let{index:t,char:n,line:i,numRepeats:r,exactMatch:s}=e;if(s&&t-r-1>=0&&i.charAt(t-r-1)===n)return!1;for(let e=0;e<r;e++)if(i.charAt(t-e-1)!==n)return!1;return!0},q=(e,t,n)=>{if(n-1>0&&" "===e.charAt(n-1))return null;for(let i=n-1;i>=0;i--){if(" "===e.charAt(i))continue;let r=!1;switch(t){case"BOLD":for(let{char:t,sequence:s}of f.BOLD)e.charAt(i)!==t&&e.charAt(n)===t&&Y({index:i,char:t,line:e,numRepeats:s.length,exactMatch:!1})&&(r=!0);break;case"ITALIC":for(let{char:t,sequence:s}of f.ITALIC)if(e.charAt(i)!==t&&e.charAt(n)===t&&Y({index:i,char:t,line:e,numRepeats:s.length,exactMatch:!1})){if("_"===t){let t=i-s.length-1;(t<0||" "===e.charAt(t))&&(r=!0)}else r=!0}break;case"STRIKETHROUGH":for(let{char:t,sequence:s}of f.STRIKETHROUGH)e.charAt(i)!==t&&e.charAt(n)===t&&Y({index:i,char:t,line:e,numRepeats:s.length,exactMatch:!1})&&(r=!0)}if(r)return{start:i,end:n}}return null};function z(e,t){if(!D(e))return null;let n=e.getSelection(),i=W(e),r=n.getAnchorOffset();if(0===r&&""===t){let t=e.getCurrentContent().getBlockBefore(i.getKey());if(!t)return null;i=t,r=t.getLength()}let s=i.getText();for(let e of Object.keys(f))for(let n of f[e]){let{char:i,sequence:o}=n;if(t!==i&&Y({index:r,char:i,line:s,numRepeats:o.length,exactMatch:!0})){let t=q(s,e,r-o.length);if(t)return{sequence:o,style:e,range:t}}}return null}function J(e,t){if(" "!==t||!D(e))return null;let n=e.getSelection(),i=W(e);if(" "===t){let e=s()(i.getText().slice(0,n.getAnchorOffset()));if(k.has(e))return"unordered-list-item";if("1."===e)return"ordered-list-item"}return null}function V(e,t,n){let{sequence:r,style:s,range:o}=n;if(t.length){let n=i.Modifier.insertText(e.getCurrentContent(),$(e,{start:o.end+r.length,end:o.end+r.length}),t);e=i.EditorState.push(e,n,"insert-characters")}let l=i.Modifier.removeRange(e.getCurrentContent(),$(e,{start:o.end,end:o.end+r.length}),"backward");l=i.Modifier.removeRange(l,$(e,{start:o.start-r.length,end:o.start}),"backward");let a={start:o.start-r.length,end:o.end-r.length},d=$(e,a),h=i.Modifier.applyInlineStyle(l,d,s);e=i.EditorState.push(e,h,"change-inline-style");let c={start:a.end+t.length,end:a.end+t.length};return e=i.EditorState.forceSelection(e,$(e,c))}function X(e,t){let n={start:0,end:e.getSelection().getAnchorOffset()},r=W(e).getText().slice(n.start,n.end),s=Q(e,n,`${r} `),o=Q(e=i.EditorState.push(e,s,"insert-characters"),{start:n.start,end:n.end+1},""),l={start:0,end:0},a=$(e,l),d=i.Modifier.setBlockType(o,a,t);return e=i.EditorState.push(e,d,"change-block-type"),e=i.EditorState.forceSelection(e,$(e,l))}function Z(e){let t,n;let r=[],s="",o=e=>{let t=n||r;e.profile_id||e.user_id||e.user_annotated||e.styles||e.link||e.is_hashtag?t.push(e):""!==e.t&&(t.length&&"t"in t[t.length-1]&&1===Object.keys(t[t.length-1]).length?t[t.length-1].t+=e.t:t.push(e))},l=(e,t,n)=>{let i=a.entityMap[e.key],r={};"MENTION"===i.type&&"profile_handle"in i.data.mention?(r.profile_id=i.data.mention.id,r.t=i.data.mention.profile_handle):"MENTION"===i.type?(r.user_id=i.data.mention.id,r.user_annotated=i.data.mention):"HYPERLINK"===i.type?(r.link=i.data.hyperlink,r.t=t):"EMOJI"===i.type?r.t=i.data.text:"INVITE"===i.type?(r.t=i.data.mention.email,r.user_id=i.data.mention.id):"HASHTAG"===i.type?(r.t=t.substring(1),r.is_hashtag=!0):(r.t=t,n.length&&(r.styles=n)),o(r)},a=(0,i.convertToRaw)(e.getCurrentContent()),c="";return a.blocks.forEach(e=>{let i=(0,h.Qt)((0,d.F)(e.text)||"");["ordered-list-item","unordered-list-item"].includes(e.type)?(e.type!==s&&(n&&r.push({styles:["ordered-list-item"===s?"ol":"ul"],children:t}),t=[],n=[]),t||(t=[]),n||(n=[]),s=e.type.slice()):(r.length&&""===s&&o({t:"\n"}),n&&(r.push({styles:["ordered-list-item"===s?"ol":"ul"],children:t}),t=void 0,n=void 0),s="");let a={};e.entityRanges.forEach(e=>{a[e.offset]=e});let g={};(0,p.V)(e.text).forEach(e=>{let{start:t,end:n}=e;for(let e=t;e<n;e++)if(a[e])return;g[t]=e});let f={};e.inlineStyleRanges.forEach(e=>{e.offset in f?f[e.offset].push(e):f[e.offset]=[e]});let y=[],m={};for(let e=0;e<i.length;e++){if(e in m&&y.length&&(o({t:c,styles:[...y]}),c="",y=y.filter(t=>!m[e].includes(t))),e in a){let t=a[e];if(y.length)for(var S in o({t:c,styles:[...y]}),y=[],m)Number(S)>e+t.length&&y.push(...m[S]);else o({t:c});c="",l(t,i.slice(e,e+t.length).join(""),y),e+=t.length-1;continue}if(e in g){let t=g[e],n=t.end-t.start;if(y.length)for(var S in o({t:c,styles:[...y]}),y=[],m)Number(S)>e+n&&y.push(...m[S]);else o({t:c});c="",o({t:i.slice(e,e+n).join(""),link:t.href}),e+=n-1;continue}e in f&&(y.length?o({t:c,styles:[...y]}):o({t:c}),c="",f[e].forEach(e=>{if(u[e.style]){let t=u[e.style];y.push(t);let n=e.offset+e.length;n in m?m[n].push(t):m[n]=[t]}})),c+=i[e]}y.length?o({t:c,styles:[...y]}):o({t:c}),c="",n&&(0===n.length&&n.push({t:""}),t.push({children:n}),n=[])}),n&&r.push({styles:["ordered-list-item"===s?"ol":"ul"],children:t}),r}let ee=(e,t,n,i,r,s="default",o)=>{let l=[],u=[],f="",y=[];e.forEach(e=>{let t=(0,d.F)(e.t);if(t){let n=t.split("\n");1===n.length?y.push(e):n.forEach((t,i)=>{let r=i<n.length-1?`${t}
`:t;void 0!==e.styles?y.push({t:r,styles:e.styles}):y.push({t:r})})}else y.push(e)}),y.forEach(e=>{var y,m,S;let E=(0,d.F)(e.t);if(o){for(let e of o)if(null==E?void 0:E.includes(e)){let t=E.indexOf(e),n={can_view:!0,email:e,handle:e,id:`invite-${e}`};l.push({key:Object.keys(i).length,length:(0,h.Qt)(e).length,offset:f.length+t}),i[Object.keys(i).length]={type:"INVITE",mutability:"IMMUTABLE",data:{mention:n}}}}if(null==(y=e.children)?void 0:y.length){""!==f&&(r.push({text:f,entityRanges:l,type:s,depth:0,inlineStyleRanges:u,key:r.length.toString()}),f="",u=[],l=[]);let a=(null==(m=e.styles)?void 0:m.includes("ol"))?"ordered-list-item":"unordered-list-item";e.children.forEach(e=>{var s;(null==(s=e.children)?void 0:s.length)&&ee(e.children,t,n,i,r,a,o)})}else if(e.user_annotated||e.profile_id){let t=e.user_annotated?(0,d.F)(e.user_annotated.handle)||"":"@"+E,n=e.user_annotated?e.user_annotated:{id:e.profile_id,profile_handle:E};l.push({key:Object.keys(i).length,length:(0,h.Qt)(t).length,offset:(0,h.Qt)(f).length}),i[Object.keys(i).length]={type:"MENTION",mutability:"IMMUTABLE",data:{mention:n}},f+=t}else if(e.link&&(0,p.$)((0,c.xT)(e.link)))l.push({key:Object.keys(i).length,length:(0,h.Qt)(E).length,offset:(0,h.Qt)(f).length}),i[Object.keys(i).length]={type:"HYPERLINK",mutability:"MUTABLE",data:{hyperlink:e.link,commentEditorType:n}},f+=E;else if(e.is_hashtag){let t="#"+e.t;l.push({key:Object.keys(i).length,length:(0,h.Qt)(t).length,offset:(0,h.Qt)(f).length}),i[Object.keys(i).length]={type:"HASHTAG",mutability:"MUTABLE",data:{}},f+=t}else{if(null==(S=e.styles)?void 0:S.length)e.styles.forEach(e=>{if(g[e]){let t=g[e];u.push({style:t,length:(0,h.Qt)(E).length,offset:(0,h.Qt)(f).length})}});else if((0,a.Lg)(E)){let e=(0,a.wd)(E),t=0,n="";for(let r of e){let e="",s="";(0,a.xM)(r)&&((0,a.UF)(r).forEach(t=>{e+=t.unicode,s+=t.meta}),l.push({key:Object.keys(i).length,length:(0,h.Qt)(e).length,offset:(0,h.Qt)(f).length+t}),i[Object.keys(i).length]={type:"EMOJI",mutability:"IMMUTABLE",data:{text:s,unicode:e}}),n+=e.length?e:r,t+=(0,h.Qt)(e.length?e:r).length}E=n}(null==E?void 0:E.endsWith("\n"))?(f+=E.slice(0,-1),r.push({text:f,entityRanges:l,type:s,depth:0,inlineStyleRanges:u,key:r.length.toString()}),f="",l=[],u=[]):f+=E}}),(""!==f||"default"!==s)&&r.push({text:f,entityRanges:l,type:s,depth:0,inlineStyleRanges:u,key:r.length.toString()})};function et(e,t,n,r){let s={},o=[];ee(e,t,n,s,o,"default",r);let l=(0,i.convertFromRaw)({blocks:o,entityMap:s});return i.EditorState.createWithContent(l,t)}let en=e=>{let t=e.getCurrentContent().getFirstBlock(),n=t.getKey(),r=t.getLength();return i.EditorState.acceptSelection(e,new i.SelectionState({anchorKey:n,anchorOffset:r,focusKey:n,focusOffset:r,isBackward:!1}))};function ei(e){let t=en(e);return i.EditorState.forceSelection(t,t.getSelection())}let er=e=>{let t=e.getAttribute("data-mention-user-id"),n=e.getAttribute("data-tooltip-user-handle");return t&&n?{id:t,handle:n}:null},es=e=>e.getAttribute("data-tooltip-url-string");function eo(e,t){var n=new DOMParser().parseFromString(e,"text/html"),r=n.getElementsByTagName("a");let s={};for(let e=0;e<r.length;e++){r[e].setAttribute("href",new URL(r[e].href,document.baseURI).toString());let t=r[e].getAttribute("href"),n=er(r[e]);n&&t&&(s[t]=n);let i=es(r[e]);i&&r[e].setAttribute("href",i)}n.querySelectorAll('[data-stringify-type="paragraph-break"]').forEach(function(e){let t=n.createElement("br");e.parentNode&&e.parentNode.replaceChild(t,e)});let o=n.querySelector("body"),l=o?o.innerHTML:n.documentElement.outerHTML,a=l.includes("<!--StartFragment-->")?l:l.replace(/(?:\r\n|\r|\n)/g,"<br/>"),d=(0,i.convertFromHTML)(a),h=i.ContentState.createFromBlockArray(d.contentBlocks,d.entityMap);return h.getBlockMap().forEach(e=>{null==e||e.findEntityRanges(e=>{let t=e.getEntity();return!!t&&"LINK"===h.getEntity(t).getType()},(n,r)=>{let o=e.getText().slice(n,r),l=i.SelectionState.createEmpty(e.getKey());l=l.merge({anchorOffset:n,focusKey:e.getKey(),focusOffset:r});let a=e.getEntityAt(n),d=h.getEntity(a).getData().url,u=s[d];u&&u.handle===o?h=h.createEntity("MENTION","IMMUTABLE",{mention:s[d]}):(0,p.$)((0,c.xT)(d))&&(h=h.createEntity("HYPERLINK","MUTABLE",{hyperlink:d,editorType:t}));let g=h.getLastCreatedEntityKey();h=i.Modifier.applyEntity(h,l,g)})}),h}},583630:(e,t,n)=>{n.r(t),n.d(t,{FeedPostCommentComposer:()=>D,FeedPostUnifiedComposer:()=>j});var i=n(411855),r=n(188507),s=n(629019),o=n.n(s),l=n(728287),a=n(27050),d=n(377750),h=n(609494),c=n(966712),p=n(860601),u=n(67833),g=n(574176),f=n(939863),y=n(901765),m=n(975350),S=n(463304),E=n(112235),C=n(531827),k=n(440535),T=n(498606),v=n(238559),b=n(113292),M=n(555648),I=n(710381),K=n(227795),A=n(57289),O=n(229443),_=n(963462),x=n(126674),B=n(660040),L=n(988898),F=n(39107),H=n(138740),w=n(740998),R=n(159696);let P="feed-post-title-placeholder",N="feed-post-title",U="feed-post-title-danger";function D(e){let t;let n=(0,r.wA)(),s=(0,b._B)(),o=i.useRef(null),l=i.useRef(null),a=i.useRef(null),{onSubmit:d,onCancel:c,updateMessage:u}=e,g=i.useCallback(()=>{var t,n,i;if(c){o.current&&o.current.hasFocus()&&(null==(t=l.current)||t.focus()),c(),s.onClear();return}(0,h.I)(e.messageContent)?o.current&&o.current.hasFocus()&&(null==(n=l.current)||n.focus()):(u([]),s.onClear()),(null==(i=a.current)?void 0:i.visible)&&a.current.clearDecorators()},[a,e.messageContent,c,u,s]),y=i.useMemo(()=>(0,h._Z)(e.messageContent,{includeTrailingWhitespace:!0}).length,[e.messageContent]),m=i.useCallback(()=>{var t;(0,h.I)(e.messageContent)||e.maxCommentLength&&y>e.maxCommentLength||(d&&d(),o.current&&o.current.hasFocus()&&(null==(t=l.current)||t.focus()),s.onClear())},[d,e.messageContent,s,y,e.maxCommentLength]),S=(0,r.d4)(e=>e.comments.typeahead),E=i.useCallback(e=>e,[]);return l.current&&(t=l.current.getBoundingClientRect()),i.createElement(i.Fragment,null,i.createElement("div",{ref:l,tabIndex:0,className:L.cA},i.createElement(I.C,{fallback:null,errorFallback:null,dispatch:n,editorRef:o,typeahead:S,onCancel:g,onSubmit:m,user:e.user,threadPosition:null,viewportPositionFromClientPosition:E,submitText:(0,f.t)("comments.post"),placeholderText:e.placeholderText?e.placeholderText:(0,f.t)("fig_feed.add_a_comment"),editorOnClear:s.editorOnClear,editorOnInsert:s.editorOnInsert,setIsEditorFocused:s.setIsEditorFocused,messageMeta:e.messageContent,threadId:k.hm,fileKey:null,editingExistingComment:e.editingExistingComment,recordingKey:k.Dw.feed,mountInputFocused:e.autofocus,hideEmojiPicker:!1,allowAttachments:!0,attachments:e.attachments,deleteAttachment:e.deleteAttachment,updateAttachment:e.updateAttachment,updateMessage:e.updateMessage,mentionables:e.mentionables,scrollToBottom:e.scrollToBottom?e.scrollToBottom:p.lQ,containerClassName:e.composerContainerClass,editableTypeaheadClassName:e.editableTypeaheadClass,hideSubmitButton:e.hideSubmitButton,submitOnEnter:e.submitOnEnter,editorType:"comment-editor-feed",maintainSelectionOnFocus:!0})),!(0,h.I)(e.messageContent)&&t&&i.createElement(v.Uu,{decoratorsRef:a,onClear:s.onClear,onInsert:s.onInsert,width:t.width,direction:e.displayDecoratorsDownwards?A.ri.DOWNWARDS:A.ri.UPWARDS,targetRect:t,useFixedPosition:!0}))}function j(e){let t;let n=(0,r.wA)(),s=(0,b._B)(),k=i.useRef(null),I=i.useRef(null),D=i.useRef(null),{onSubmit:j,updateTitle:G,updateDescription:W,openPostFromFileModal:$}=e,Q=i.useCallback(()=>{var t,n;ec(!1),k.current&&k.current.hasFocus()&&(null==(t=e.parentRef)?void 0:t.current)&&e.parentRef.current.focus(),(null==(n=D.current)?void 0:n.visible)&&D.current.clearDecorators()},[D,e.parentRef]),Y=i.useCallback(()=>{(0,h.I)(e.description)||(j&&j(),s.onClear())},[j,e.description,s]),q=(0,r.d4)(e=>e.comments.typeahead);I.current&&(t=I.current.getBoundingClientRect());let[z,J]=i.useState(!1),V=i.useRef(null);(0,y.L)(V,()=>J(!1),!0);let X=i.useMemo(()=>(0,h.I)(e.description),[e.description]),Z=i.useMemo(()=>!e.title&&X,[e.title,X]),ee=i.useMemo(()=>[{t:"\n"},{t:"\n"}],[]),[et,en]=i.useState(Z?ee:[{t:`${e.title}
`}].concat(e.description)),[ei,er]=i.useState(!1),[es,eo]=i.useState(void 0),el=i.useCallback(([e,t])=>{let n=t.getCurrentContent().getFirstBlock(),i=t.getCurrentContent().getBlocksAsArray();i.shift();let r=n.getKey(),s=n.getText();eo(r);let o=l.ContentState.createFromBlockArray(i),a=l.EditorState.createWithContent(o),d=(0,_.yN)(a);er(r===t.getSelection().getEndKey()),G(s),W(d),0===i.length?(en([...e,...ee]),setTimeout(()=>{var e;null==(e=k.current)||e.moveFocusBefore()},0)):en(e)},[G,W,ee]),ea=i.useMemo(()=>{let t={};return es&&(e.title?t[es]=e.title.length>B.Y?U:N:t[es]=P),t},[es,e.title]),ed=i.useCallback(t=>t.getType()===P?L.kX:t.getType()===N?L.pN:t.getType()===U?L.u6:(0,h.I)(e.description)?L.UD:L.xT,[e.description]);i.useEffect(()=>{e.minimized&&J(!1)},[e.minimized]);let[eh,ec]=i.useState(!1),[ep,eu]=i.useState(!1),eg=i.useRef(null),ef=(0,r.d4)(e=>{var t;return(null==(t=e.openFile)?void 0:t.key)||null}),ey=(0,r.d4)(e=>{var t;return null==(t=e.openFile)?void 0:t.teamId}),em=(0,r.d4)(e=>e.orgUsersByOrgId),eS=(0,r.d4)(e=>e.dropdownShown||null),eE=(0,r.d4)(e=>e.comments.editingComment),eC=i.useCallback(()=>(k.current&&k.current.handleEscape(),!1),[]),ek=i.useCallback(()=>{J(!0),eh||ec(!0)},[eh]),eT=i.useRef(null),ev=e=>{if(k&&k.current){let t=((0,c.kc)().emoji_15_upgrade?d.dN:a.dN).get(e.id);t&&k.current.insertEmoji(t),n(m.RI({visible:!1}))}},eb=async()=>{var t;ei||(n(m.We(await (0,C.fG)("",e.mentionables,!1))),eu(!0),setTimeout(()=>{eu(!1)},250),null==(t=k.current)||t.focus(!1))},eM=(0,E.p)(),eI=i.useMemo(()=>e.fileData?eM(e.fileData):void 0,[e.fileData,eM]),eK=(0,x.lM)(e.currentOrgId);return i.createElement("div",{className:o()(e.minimized?L.Lp:z?L.ik:L.$7,L.pG),ref:V,onBlur:()=>J(!1),style:{"--feed-post-title-placeholder":`"${(0,f.t)("fig_feed.give_your_post_a_title")}"`,"--feed-post-description-placeholder":`"${(0,f.t)("fig_feed.dive_into_the_details")}"`}},!e.minimized&&i.createElement("div",{ref:I,className:L.n0},i.createElement("div",{className:L.kK,ref:eg,"data-testid":"comment-composer-container"},i.createElement(S.$W,{handleEscape:eC,priority:S.KD.EDITING_TEXT_FIELD},i.createElement(O.iX,{ref:k,editorType:"comment-editor-feed",editorRef:k,dispatch:n,delegateEscapeHandling:!0,typeahead:q,mentionables:e.mentionables,onUpdateTextArea:p.lQ,onSubmit:Y,onFocus:ek,onCancel:Q,editorOnClear:s.editorOnClear,editorOnInsert:s.editorOnInsert,setIsEditorFocused:s.setIsEditorFocused,updateMessage:el,messageMeta:et,className:e.editableTypeaheadClass,mountInputFocused:e.autofocus,initMention:ep,submitOnEnter:e.submitOnEnter??!0,user:e.user,openFileKey:ef,currentOrgId:e.currentOrgId,openFileTeamId:ey,currentOrgUsers:em,readOnly:e.readOnly,dropdownShown:eS??void 0,editingComment:eE??void 0,isProtoView:!1,blockStyleFn:ed,blockKeyToType:ea,updateMessageOnMount:!0,moveFocusToStartOnMount:Z,maintainSelectionOnFocus:!0,feedTitleBlockKey:es,enableHashtags:!0,hashtagSearchLibrary:eK})),i.createElement("div",{className:L.o1},i.createElement("div",{className:L.xu},M.Y&&i.createElement(K.K0,{svg:H.A,onClick:()=>{var e;let t=null==(e=eT.current)?void 0:e.getBoundingClientRect();t&&n(m.RI({visible:!0,targetRect:t,onPick:ev}))},ref:eT,onMouseDown:e=>e.stopPropagation(),"data-tooltip-type":T.Ib.TEXT,"data-tooltip":(0,f.t)("comments.add_emoji"),dataTestId:"emoji-picker-button",recordingKey:"emojiPicker",disabled:!1}),i.createElement(K.K0,{tabIndex:X?-1:0,svg:F.A,onClick:eb,onMouseDown:e=>e.stopPropagation(),"data-tooltip-type":T.Ib.TEXT,"data-tooltip":(0,f.t)("comments.add_mention"),disabled:X||ei,recordingKey:"mentionButton"})),!e.editingPost&&(e.fileData||!e.lockFileAddition)&&i.createElement("div",{className:e.fileData?L.r3:L.xw,onClick:e.readOnly||e.lockFileAddition?void 0:$,role:"button",tabIndex:0},e.fileData&&void 0!==eI?i.createElement(i.Fragment,null,i.createElement(u.oS,{type:eI,size:u.LE.SMALL}),e.fileData.name):i.createElement(i.Fragment,null,i.createElement(g.B,{svg:w.A}),(0,f.t)("fig_feed.link_figma_file")),e.fileData&&e.canUnlinkFile&&i.createElement(g.B,{svg:R.A,onClick:t=>{var n;t.stopPropagation(),null==(n=e.unlinkFile)||n.call(e)}}))))),t&&i.createElement(v.Uu,{decoratorsRef:D,onClear:s.onClear,onInsert:s.onInsert,width:t.width,direction:e.displayDecoratorsDownwards?A.ri.DOWNWARDS:A.ri.UPWARDS,targetRect:t,useFixedPosition:!0,mentionsDisabled:ei,hashtagsDisabled:ei}))}},660040:(e,t,n)=>{n.d(t,{Y:()=>i,e:()=>r});let i=80,r=3e3}}]);

//# debugId=c536ced3-86cb-5375-82b8-c395b760a700

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/95dfd14aa7f781083e33d36c521a587033fa64ec/3630-d4e0bb15676e6864.min.js.map