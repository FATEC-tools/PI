"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c2377d34-1ec1-5289-9e38-23337e155386")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[945],{36097:(e,t,a)=>{a.d(t,{zE:()=>L,NA:()=>C,uM:()=>O});var i=a(67249),r=a(84934),o=a(11617),n=a(17333),l=a(98977),s=a(74626),d=a(88395),_=a(79940),c=a(76621),m=a(4783),u=a(3457),h=a(37870);let p=a(21898).A.createLazyComponent(()=>Promise.all([a.e(137),a.e(876),a.e(920),a.e(739),a.e(945),a.e(817)]).then(a.bind(a,28752)).then(e=>e.AutosaveNewFileAlreadyOpenModal),{loading:()=>null,error:u.H4.NONE,componentName:"AutosaveNewFileAlreadyOpenModal"}),f=(0,h.Ju)(p);var g=a(62275),w=a(74105),T=a(53297),E=a(96226),N=a(56390);let A=0;var v=a(69870),y=a(35926),I=a(9511),b=a(99506),M=a(84968),P=a(65167),R=a(874),F=a(45020),D=a(51363),S=a(84129),k=a(80820);let L=(0,k.nF)((e,{state:t,from:a,editorType:i,team:r,openNewFileIn:o,fileName:n,folderId:l,isDraftsFolder:s,callback:d,presetName:_,inFileCreationDefaultsExp:c,figjamAiNewFileData:m,figjamMakeSomethingUseCase:u})=>{var h;if(r&&!s&&("design"===i&&!(0,M.rR)(r,{type:M.sK.ADD_DESIGN_FILE})||"whiteboard"===i&&!(0,M.rR)(r,{type:M.sK.ADD_FIGJAM_FILE}))){(null==(h=r.restrictions_list)?void 0:h.includes(b.P4.LOCKED))||l?e.dispatch(g.to({type:S.DV,data:{team:r,resource:R.vL.FILE,action:c?D.ZN.CREATE_FILE_FROM_DROPDOWN:D.ZN.CREATE_FILE,editorType:i,currentPlan:E.F.Plan.STARTER,upsellPlan:E.F.Plan.PRO}})):e.dispatch(g.to({type:S.DV,data:{team:r,resource:R.vL.FILE,action:D.ZN.CREATE_FILE,editorType:i,currentPlan:E.F.Plan.STARTER,upsellPlan:E.F.Plan.PRO}})),d&&d(null);return}let p=l?{folderId:l}:a!==F.f6.FILE_BROWSER_SIDEBAR_DRAFTS&&a!==F.f6.FILE_BROWSER_TEAM_FILE_LIMIT_PAYWALL&&a!==F.f6.FILE_BROWSER_TOOLBAR_RECENTS&&a!==F.f6.FILE_BROWSER_TOOLBAR_DRAFTS&&r?null:"drafts",f=(0,w.xA)(t,o,p,{from:a,selectedView:t.selectedView},i,n,d,m,u);_&&(f.framePresetName=_),e.dispatch(U(f))}),O=(0,k.nF)((e,t)=>{e.dispatch(U(t))}),C=(0,k.nF)((e,{file:t,openNewFileIn:a,source:i})=>{let o=e.getState().user;if(!o)return;let l=()=>{let o=(0,P.B)(t,a);e.dispatch(O(o)),(0,r.sx)("New Autosave File Open",{openNewFileIn:a,source:i})};n.eD?l():(0,T.M)(o.id,t).then(a=>{if(a){e.dispatch(g.to({type:f,data:{file:t}}));return}l()})}),U=(0,k.nF)((e,t)=>{if((0,v.ck)()||!t.allowOnDesktop&&Date.now()-A<600)return;let a=(0,y._I)(t);if(N.Y5.resetLoadedFigFile(),n.eD){if(t.allowOnDesktop)(0,y.$N)(e,t,!1);else{(0,y.J5)(e,t);return}}else if(t.openNewFileIn===F.ai.NEW_TAB){let e=(0,_.lF)(a);l.Ay.redirect(`/file/new${e?"?"+e:""}`,"_blank")}else if((0,o.N7)(e.getState().currentUserOrgId,t.org_id)){s.zl.get(d.b)&&(0,c.$D)(m.e.SCENEGRAPH_AND_SYNC,Error("Trying to switching org ids while in offline file browser"));let e=(0,_.lF)(a);l.Ay.redirect(`/file/new${e?"?"+e:""}`)}else(0,y.$N)(e,t,!1);A=Date.now();let i=t.openNewFileIn===F.ai.SAME_TAB&&(!n.eD||t.allowOnDesktop)?I.Oin.HIDE_UI:I.Oin.OFF;e.dispatch(G({openNewFileIn:t.openNewFileIn,progressBarMode:i}))}),G=(0,i.N)("FULLSCREEN_NEW_FILE_OPEN")},2957:(e,t,a)=>{a.d(t,{$w:()=>E,aB:()=>w,bE:()=>y,bQ:()=>T,ii:()=>h,mw:()=>p,n9:()=>g,r1:()=>f,uo:()=>N,yH:()=>v,yJ:()=>A});var i=a(67249),r=a(98977),o=a(208),n=a(81388),l=a(39863),s=a(23026),d=a(92592),_=a(80820),c=a(20741),m=a(45213);(0,_.MM)("TEAM_REMOVE_FROM_TEAM",(e,{teamId:t,userId:a,userInitiated:i},{optimistId:r})=>{i&&o.Ay.del(`/api/teams/${t}/users/${a}`).then(()=>{e.dispatch(_.hp.commit(r))}).catch(t=>{e.dispatch(_.hp.revert(r));let a=(0,l.t)("file_browser.file_browser_actions.error_on_team_member_removal");e.dispatch(n.s.error(a)),console.error(t)})}),(0,_.MM)("BATCH_DEL_TEAM_MEMBERS",(e,{teamId:t,userIds:a},{optimistId:i})=>{o.Ay.del(`/api/teams/${t}/users`,{user_ids:a}).then(()=>{e.dispatch(_.hp.commit(i))}).catch(t=>{e.dispatch(_.hp.revert(i))})}),(0,_.nF)(async(e,t)=>{let{teamId:a}=t;await o.Ay.put(`/api/teams/${a}/restore`).then(()=>{let t=`/files/team/${a}`;r.Ay.redirect(t),e.dispatch(n.s.flash((0,l.t)("file_browser.file_browser_actions.restore_team_success")))}).catch(t=>{e.dispatch(n.s.error((0,l.t)("file_browser.file_browser_actions.restore_team_error",{errorMsg:t.data.message||(0,l.t)("file_browser.file_browser_actions.unknown_error")})))})}),(0,_.nF)(async(e,t)=>{await o.Ay.put(`/api/teams/${t.teamId}`,{description:t.description}).then(()=>{e.dispatch(A({team:{id:t.teamId,description:t.description},userInitiated:!0}))}).catch(()=>{e.dispatch(n.s.error((0,l.t)("file_browser.file_browser_actions.update_description_error")))})}),(0,_.nF)(async(e,t)=>{let a=t.figma_provided_libraries_disabled;await m.$.updatePresetsDisabled({teamId:t.teamId,presetsDisabled:a}).then(()=>{e.dispatch(d.F.enqueue({message:a?(0,l.t)("settings_tab.ui_kits_disabled"):(0,l.t)("settings_tab.ui_kits_enabled"),type:"team.ui_kit_toggle",error:!1})),e.dispatch(A({team:{id:t.teamId,figma_provided_libraries_disabled:a},userInitiated:!0}))}).catch(()=>{e.dispatch(n.s.error((0,l.t)("file_browser.error_try_again")))})}),(0,_.T8)("TEAM_GET_CMTY_PUBLISH_AS_USER_ENABLED",(e,{teamId:t},{loadingKey:a})=>{let i=m.$.getTeam({teamId:t});(0,c.N)(i,e,a),i.then(({data:t})=>{e.dispatch(A({team:t.meta,userInitiated:!1}))}).catch(()=>{e.dispatch(n.s.error((0,l.t)("file_browser.error_try_again")))})}),(0,_.T8)("TEAM_FETCH_MEMBERS_LIST",(e,{teamId:t,userInitiated:a=!0},{loadingKey:i})=>{let r=m.$.getMembers({teamId:t});a&&(0,c.N)(r,e,i),r.then(({data:a})=>{let i={};a.meta.forEach(e=>{i[e.email]=e}),e.dispatch(u({members:i,teamId:t}))},t=>{console.error(t),e.dispatch(n.s.error((0,l.t)("file_browser.file_browser_actions.team_member_fetch_error")))})},e=>`TEAM_FETCH_MEMBERS_LIST::teamId::${e.teamId}`);let u=(0,i.N)("TEAM_SET_MEMBERS"),h=(0,i.N)("TEAM_BATCH_JOIN"),p=(0,i.N)("TEAM_JOIN");(0,i.N)("TEAM_STOP_RENAME"),(0,i.N)("TEAM_BEGIN_RENAME");let f=(0,i.N)("TEAM_CREATION_SET_LOADING"),g=(0,i.N)("TEAM_CHANGE_DEFAULT_PERMISSION"),w=(0,i.N)("TEAM_CHANGE_SHARING_SETTINGS"),T=(0,i.N)("TEAM_CHANGE_ORG_ACCESS");(0,i.N)("TEAM_LOADED");let E=(0,i.N)("TEAM_RENAME"),N=(0,i.N)("TEAM_BATCH_PUT"),A=s.RF,v=s.Nh,y=(0,i.N)("TEAM_POST");(0,i.N)("TEAM_GET")},57858:(e,t,a)=>{a.d(t,{$W:()=>l});var i=a(39863);let r=[{name:"iPhone 14 & 15 Pro Max",width:430,height:932,i18nName:()=>(0,i.t)("presets.i_phone_14_and_15_pro_max")},{name:"iPhone 14 & 15 Pro",width:393,height:852,i18nName:()=>(0,i.t)("presets.i_phone_14_and_15_pro")},{name:"iPhone 13 & 14",width:390,height:844,i18nName:()=>(0,i.t)("presets.i_phone_13_and_14")},{name:"iPhone 14 Plus",width:428,height:926,i18nName:()=>(0,i.t)("presets.i_phone_14_plus")},{name:"iPhone 13 mini",width:375,height:812,i18nName:()=>(0,i.t)("presets.i_phone_13_mini")},{name:"iPhone SE",width:320,height:568,i18nName:()=>(0,i.t)("presets.i_phone_se")},{name:"iPhone 8 Plus",width:414,height:736,i18nName:()=>(0,i.t)("presets.i_phone_8_plus")},{name:"iPhone 8",width:375,height:667,i18nName:()=>(0,i.t)("presets.i_phone_8")},{name:"Android Small",width:360,height:640,i18nName:()=>(0,i.t)("presets.android_small")},{name:"Android Large",width:360,height:800,i18nName:()=>(0,i.t)("presets.android_large")}],o=[{name:"MacBook Air",width:1280,height:832,i18nName:()=>(0,i.t)("presets.mac_book_air_m2")},{name:'MacBook Pro 14"',width:1512,height:982,i18nName:()=>(0,i.t)("presets.mac_book_pro_14")},{name:'MacBook Pro 16"',width:1728,height:1117,i18nName:()=>(0,i.t)("presets.mac_book_pro_16")},{name:"Desktop",width:1440,height:1024,i18nName:()=>(0,i.t)("presets.desktop")},{name:"Wireframe",width:1440,height:1024,i18nName:()=>(0,i.t)("community.categories.wireframe")},{name:"TV",width:1280,height:720,i18nName:()=>(0,i.t)("presets.tv")}],n=[{name:"Slide 16:9",width:1920,height:1080,i18nName:()=>(0,i.t)("presets.slide_16_9")},{name:"Slide 4:3",width:1024,height:768,i18nName:()=>(0,i.t)("presets.slide_4_3")}],l=(s(Object.values({phonePresets:r,tabletPresets:[{name:"Surface Pro 8",width:1440,height:960,i18nName:()=>(0,i.t)("presets.surface_pro_8")},{name:"iPad mini 8.3",width:744,height:1133,i18nName:()=>(0,i.t)("presets.i_pad_mini_8_3")},{name:'iPad Pro 11"',width:834,height:1194,i18nName:()=>(0,i.t)("presets.i_pad_pro_11")},{name:'iPad Pro 12.9"',width:1024,height:1366,i18nName:()=>(0,i.t)("presets.i_pad_pro_12_9")}],desktopPresets:o,presentationPresets:n,watchPresets:[{name:"Apple Watch 41mm",width:176,height:215,i18nName:()=>(0,i.t)("presets.apple_watch_41_mm")},{name:"Apple Watch 45mm",width:198,height:242,i18nName:()=>(0,i.t)("presets.apple_watch_45_mm")},{name:"Apple Watch 44mm",width:184,height:224,i18nName:()=>(0,i.t)("presets.apple_watch_44_mm")},{name:"Apple Watch 40mm",width:162,height:197,i18nName:()=>(0,i.t)("presets.apple_watch_40_mm")}],paperPresets:[{name:"A4",width:595,height:842,i18nName:()=>(0,i.t)("presets.a_4")},{name:"A5",width:420,height:595,i18nName:()=>(0,i.t)("presets.a_5")},{name:"A6",width:297,height:420,i18nName:()=>(0,i.t)("presets.a_6")},{name:"Letter",width:612,height:792,i18nName:()=>(0,i.t)("presets.letter")},{name:"Tabloid",width:792,height:1224,i18nName:()=>(0,i.t)("presets.tabloid")}],socialMediaPresets:[{name:"Twitter post",width:1200,height:675,i18nName:()=>(0,i.t)("presets.twitter_post")},{name:"Twitter header",width:1500,height:500,i18nName:()=>(0,i.t)("presets.twitter_header")},{name:"Facebook post",width:1200,height:630,i18nName:()=>(0,i.t)("presets.facebook_post")},{name:"Facebook cover",width:820,height:312,i18nName:()=>(0,i.t)("presets.facebook_cover")},{name:"Instagram post",width:1080,height:1080,i18nName:()=>(0,i.t)("presets.instagram_post")},{name:"Instagram story",width:1080,height:1920,i18nName:()=>(0,i.t)("presets.instagram_story")},{name:"Dribbble shot",width:400,height:300,i18nName:()=>(0,i.t)("presets.dribbble_shot")},{name:"Dribbble shot HD",width:800,height:600,i18nName:()=>(0,i.t)("presets.dribbble_shot_hd")},{name:"LinkedIn cover",width:1584,height:396,i18nName:()=>(0,i.t)("presets.linked_in_cover")}],figmaPresets:[{name:"Plugin icon",width:128,height:128,i18nName:()=>(0,i.t)("presets.plugin_icon")},{name:"Profile banner",width:1680,height:240,i18nName:()=>(0,i.t)("presets.profile_banner")},{name:"Plugin / file cover",width:1920,height:1080,i18nName:()=>(0,i.t)("presets.plugin_file_cover")}],archivedPresets:[{name:"iPhone 13 Pro Max",width:428,height:926,i18nName:()=>(0,i.t)("presets.i_phone_13_pro_max")},{name:"iPhone 13 / 13 Pro",width:390,height:844,i18nName:()=>(0,i.t)("presets.i_phone_13_13_pro")},{name:"iPhone 11 Pro Max",width:414,height:896,i18nName:()=>(0,i.t)("presets.i_phone_11_pro_max")},{name:"iPhone 11 Pro / X",width:375,height:812,i18nName:()=>(0,i.t)("presets.i_phone_11_pro_x")},{name:"Google Pixel 2",width:411,height:731,i18nName:()=>(0,i.t)("presets.google_pixel_2")},{name:"Google Pixel 2 XL",width:411,height:823,i18nName:()=>(0,i.t)("presets.google_pixel_2_xl")},{name:"iPad mini 5",width:768,height:1024,i18nName:()=>(0,i.t)("presets.i_pad_mini_5")},{name:"Surface Pro 4",width:1368,height:912,i18nName:()=>(0,i.t)("presets.surface_pro_4")},{name:"MacBook",width:1152,height:700,i18nName:()=>(0,i.t)("presets.mac_book")},{name:"MacBook Pro",width:1440,height:900,i18nName:()=>(0,i.t)("presets.mac_book_pro")},{name:"Surface Book",width:1500,height:1e3,i18nName:()=>(0,i.t)("presets.surface_book")},{name:"Apple Watch 42mm",width:156,height:195,i18nName:()=>(0,i.t)("presets.apple_watch_42_mm")},{name:"Apple Watch 38mm",width:136,height:170,i18nName:()=>(0,i.t)("presets.apple_watch_38_mm")},{name:"iMac",width:1280,height:720,i18nName:()=>(0,i.t)("presets.i_mac")},{name:"Macintosh 128k",width:512,height:342,i18nName:()=>(0,i.t)("presets.mac_128k")}]})),s([r,o,n]));function s(e){return e.reduce((e,t)=>{for(let a of t)e[a.name]=a;return e},{})}},35926:(e,t,a)=>{let i,r,o,n,l,s,d,_,c,m,u,h,p,f,g,w,T,E;a.d(t,{J5:()=>t1,_I:()=>tQ,$N:()=>t0});var N,A=a(43407),v=a(84934),y=a(17333),I=a(32284),b=a(98977),M=a(20331),P=a(66712),R=a(74626),F=a(16082),D=a(77432),S=a(208);let k=function e(){return new Promise(t=>{let a=()=>{window.removeEventListener("online",a),k=e(),t()};window.addEventListener("online",a)})}();function L(e){return"canceled"===e}class O{constructor(e){this._resolveCancelPromise=()=>{},this._cancelPromise=new Promise(e=>{this._resolveCancelPromise=e}),this._result=this.startRequest(e)}getResult(){return this._result}cancelRequest(){this._resolveCancelPromise("canceled")}async startRequest(e){let t=0;for(;;){let a=k;try{return await Promise.race([e(),this._cancelPromise])}catch(e){if(e instanceof S.Dr){if(e.status>=400&&e.status<500)throw e}else throw e}let i=await Promise.race([this._cancelPromise,(0,D.fm)(Math.min(500*Math.pow(2,t),6e4)),a]);if(i&&L(i))return i;t++}}}var C=a(79940),U=a(76621),G=a(50322),x=a(4783),V=a(43282),B=a(64887),j=a(81388),H=a(39863),$=a(62194),z=a(86640),W=a(56975),K=a(38269),J=a(39671);a(76485);var Y=a(47899),q=a(88022),Q=a(99506),Z=a(20425);let X="Enter Inspect Mode";var ee=a(44682),et=a(93017),ea=a(93360);a(82656);var ei=a(2957),er=a(29403);a(57858);var eo=a(6949);a(74105);var en=a(15467),el=a(56390),es=a(52800),ed=a(33739),e_=a(22983),ec=a(24266),em=a(60640),eu=a(9511);a(32135);var eh=a(91205),ep=a(76615);a(94517);var ef=a(45020),eg=a(47807),ew=a(30654),eT=a(65050);let eE=ew.object({script:ew.string(),name:ew.string(),file_key:ew.string(),source_file_key:ew.string().nullable(),needs_upgrade:ew.boolean(),org_drafts_owners:ew.array(eT.WU),prefix:ew.string(),shared_fonts:ew.ignore(),feature_flags:ew.ignore(),is_community_duplicate:ew.boolean(),file_repo:ew.ignore(),can_edit:ew.boolean(),show_edit_button:ew.boolean(),current_team_user:ew.ignore(),redirect_to_password_auth:ew.boolean().optional(),last_published_at:ew.string().nullable(),team:ew.ignore(),is_team_template:ew.boolean()}),eN=new class{constructor(){this.FileMetadataSchemaValidator=(0,eg.YV)("FileMetadataSchemaValidator",eE,null,!1)}getFileMetadata(e){let t=new URLSearchParams(b.Ay.location.search),a=new URLSearchParams,i=t.get("force-incremental")||"";""!==i&&a.append("force-incremental",i);let r=t.get("preload")||"";return""!==r&&a.append("preload",r),this.FileMetadataSchemaValidator.validate(async({xr:t})=>await t.get(`/api/file_metadata/${e.fileKey}?${a.toString()}`))}},eA=new class{constructor(){this.VariableSetDefaultModeSettingSchemaValidator=(0,eg.vh)()}getDefaultModes(e){return this.VariableSetDefaultModeSettingSchemaValidator.validate(({xr:t})=>"folderId"in e?t.get("/api/variable_set_default_modes/"+e.folderId):t.get("/api/variable_set_default_modes",eg.td.toAPIParameters(e)))}setDefaultMode(e){return S.Ay.post("/api/variable_set_default_modes",eg.td.toAPIParameters(e))}deleteDefaultMode(e){return S.Ay.del("/api/variable_set_default_modes",eg.td.toAPIParameters(e))}};var ev=a(38580),ey=((i=ey||{}).BRAINSTORM_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 brainstorm template interacted",i.TEAM_UPDATES_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 team updates template interacted",i.TEAM_CHART_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 team chart template interacted",i.PLANNING_AHEAD_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 planning ahead template interacted",i),eI=((r=eI||{}).BRAINSTORM="BRAINSTORM",r.UPDATES="TEAM UPDATES",r.PLAN="PLANNING AHEAD",r.TEAM="TEAM CHART",r.NONE="NONE",r),eb=((o=eb||{}).NOT_STARTED="NOT_STARTED",o.MODAL_SHOWING="MODAL_SHOWING",o.USE_CASE_STEPS="USE_CASE_STEPS",o.COMPLETED="COMPLETED",o);(0,ev.eU)("NOT_STARTED");let eM=(0,ev.eU)(eI.NONE);(0,ev.eU)(!1);var eP=a(11855),eR=a(88507);a(11617),a(97170),a(60945),a(63706),a(61870),a(95847),a(46689),a(24897),a(63659),a(72517),a(62275),a(55258),a(1538),a(98371);var eF=a(38329),eD=a(99737),eS=a(35682);a(60178);var ek=a(79453),eL=a(79296);(0,eL.D)(()=>{let e=(0,R.md)(eS.ze);return(0,eD.Rs)(ek.jmg,{fileKey:e||""})}),(0,ev.eU)(!1),a(57766),a(37499),a(11978),a(24857),a(28467);var eO=a(44673);a(99111),a(87337),a(81912),a(33556),a(86459),a(45356),a(40908),a(42830),a(11538);a(21112);let eC=(0,ev.eU)({read:!1,write:()=>{}});var eU=a(67528),eG=a(31828),ex=((n=ex||{}).AI="AI",n.STANDARD="Standard",n),eV=a(97306),eB=a(41860);class ej{constructor(){this.allTemplateInfo=new Set,this.nodeGUIDsToTemplate=new Map,ej.instance=this}static removeInstance(){ej.instance=void 0}trackNodesAsTemplate(e,t,a,i){let r=eB.qo.instance;if(Array.from(t).forEach(e=>{eH(r.get(e))||t.delete(e)}),0===t.size)return;let o=Math.floor(.1*t.size),n={templateId:e,fileKey:a,nodeGUIDs:t,trackedNodeCount:t.size,deletionThreshold:o,creationMethod:i};this.allTemplateInfo.add(n),t.forEach(e=>this.nodeGUIDsToTemplate.set(e,n))}checkForTemplateNodesDeletion(e){0!==this.allTemplateInfo.size&&e.forEach(e=>this.checkForTemplateNodeDeletion(e))}checkForTemplateNodeDeletion(e){let t=this.nodeGUIDsToTemplate.get(e);if(!t)return;this.nodeGUIDsToTemplate.delete(e);let a=t.nodeGUIDs;if(a.delete(e),a.size<=t.deletionThreshold){var i,r,o,n,l;this.stopTrackingTemplate(t),i="template_deleted",r={templateId:t.templateId,fileKey:t.fileKey,productType:"figjam",trackedNodeCount:t.trackedNodeCount,creationMethod:t.creationMethod},(0,U.Lo)(i,"trackTemplateEvent",r),(0,v.sx)(i,{userId:null==(l=null==(n=null==(o=eF.D)?void 0:o.getState())?void 0:n.user)?void 0:l.id,...r},{forwardToDatadog:!0})}}stopTrackingTemplate(e){this.allTemplateInfo.delete(e),e.nodeGUIDs.forEach(e=>this.nodeGUIDsToTemplate.delete(e))}}let eH=e=>!!e&&("CANVAS"===e.type?e.visible:eH(e.parentNode));async function e$(e,t,a,i,{enableTracking:r=!0}={}){let o=ej.instance;if(!r||!o)return await i();let n=(0,eV.UP)(),l=await i(),s=new Set((0,eV.UP)());return n.forEach(e=>s.delete(e)),t||(t="null"),o.trackNodesAsTemplate(e(),s,t,a),l}var ez=a(78260),eW=a(82947),eK=a(6757),eJ=a(40596);a(28906),a(58145),a(50769);var eY=a(85052);new eY.b("action"),new eY.b("action"),a(14716),a(57630),a(9798),a(7465),a(89584),a(88300);var eq=((l=eq||{})[l.TRUE=0]="TRUE",l[l.FALSE=1]="FALSE",l[l.LOADING=2]="LOADING",l);let eQ=(0,ev.eU)(eq.FALSE);a(17068);var eZ=a(74724),eX=((s=eX||{}).NEVER="never",s.ONCE="once",s.MORETHANEONCE="morethanonce",s),e0=((d=e0||{})[d.ENTRY=0]="ENTRY",d[d.PROMPT_BUILDER=1]="PROMPT_BUILDER",d),e1=((_=e1||{}).MEETING="meeting",_.GANTT_CHART="gantt_chart",_.BRAINSTORM="brainstorm",_.FLOW_CHART="flow_chart",_.ORG_CHART="org_chart",_.PLAN="plan",_.MIND_MAP="mind_map",_.TIMELINE="timeline",_),e8=((c=e8||{}).WEEKLY_SYNC="weekly_sync",c.PLAN="plan",c.BRAINSTORM="brainstorm",c.TEAM_RETRO="team_retro",c.ONEONONE="1:1",c.GANTT_CHART="gantt_chart",c.FLOW_CHART="flow_chart",c.ORG_CHART="org_chart",c.MIND_MAP="mind_map",c.TIMELINE="timeline",c),e2=((m=e2||{}).IN_EDITOR="in_editor",m.TEMPLATE_SHELF="template_shelf",m.COMMUNITY="community",m.ONBOARDING_MODAL="onboarding_modal",m),e4=((u=e4||{}).GENERATE_MODE="generate_stage",u.REFINEMENT_MODE="refinement_stage",u),e6=((h=e6||{}).TEMPLATE="template",h.VISUAL="visual",h);async function e3({prompt:e,signal:t,authInfo:a}){let i=await eZ.Ay.figjam.classifyCreate({prompt:e},a);return t.aborted?null:i.type}async function e7(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}a(63142);var e9=((p=e9||{}).FREEFORM="freeform",p.SUGGESTION="suggestion",p.AUTOCOMPLETE="autocomplete",p),e5=((f=e5||{}).AI_PROMPT_EDITED="ai_prompt_edited",f.AI_PROMPT_BUILDER_OUTPUT_REQUESTED="ai_prompt_builder_output_requested",f.AI_PROMPT_BUILDER_OUTPUT_STREAMING="ai_prompt_builder_output_streaming",f.AI_PROMPT_BUILDER_OUTPUT_CREATED="ai_prompt_builder_output_created",f.AI_PROMPT_REQUEST_ERROR="ai_prompt_request_error",f.AI_PROMPT_SUGGESTIONS_VIEWED="ai_prompt_suggestions_viewed",f);let te=e=>"board"===e?"template":"visual";function tt(e,t,a,i,r,o,n,l,s,d,_){let c="inappropriate"===r?r:te(r);e7(i).then(r=>{(0,v.sx)("ai_prompt_builder_output_requested",{fileKey:e,variantIndex:t,numVariants:a,promptId:r,outputType:c,oneClickPromptUseCase:s,oneClickPromptUseCaseCategory:l,oneClickPromptUseCaseSubCategory:d,numCharactersInput:i.length,localOutputId:R.zl.get(tr),stage:o,uiTriggeredFrom:n,autocompletePromptAddition:_},{forwardToDatadog:!0})})}function ta(e,t){(0,v.sx)("ai_prompt_request_error",{fileKey:e,errorMessage:t},{forwardToDatadog:!0})}let ti=(0,ev.eU)(null),tr=(0,ev.eU)(0);var to=((g=to||{}).LOADING="loading",g.ERROR="error",g.SUCCESS="success",g.NONE="none",g),tn=a(99999),tl=a(9225),ts=a(15009),td=a(62531),t_=a(88633);async function tc(e,t){let a="";switch(e){case"COMPONENT":a=await (0,t_.$C)(t);break;case"COMPONENT_SET":a=await (0,t_.$f)(t);break;default:throw Error(`Unknown component type ${e}`)}return a}async function tm({prompt:e,signal:t,fileKey:a,authInfo:i,shouldJumpToNewLine:r=null,orgId:o}){var n,l,s;let d,_;d=globalThis.AI_DEBUG_XML&&(0,P.kc)().figjam_text_to_template_debug?await eZ.Ay.figjam.createTemplate({prompt:e,mode:tn.Wc.PASSTHROUGH_XML_DEBUG_ONLY},i):await eZ.Ay.figjam.createTemplate({prompt:e,mode:tn.Wc.DESCRIPTION},i),await el.Y5.onReady(),es.vlL.resetInsertionLocation(r);let c=d.getReader(),m=[];async function u(){if(0===m.length)return;let e=performance.now();for(;performance.now()-e<32;){let e=m.shift();if(!e)break;let t=td.l7.system("ai-add-template",()=>es.vlL.handleFigJamTemplateStreamMessage(e));(0,U.Lo)("handleTextToTemplate","Create or update response message",{message:t})}await new Promise(e=>setTimeout(e,0))}try{for(;;){await u();let{done:i,value:r}=await c.read();if(t.aborted)break;if(null==r?void 0:r.createNodes)for(let e of r.createNodes){if((0,U.Lo)("handleTextToTemplate","Create or update node",e),"INSTANCE"===e.node.type&&e.node.componentType&&e.node.componentKey){let t=(0,ts.Po)(e.node.componentKey);try{let a=await tc(e.node.componentType,t);a&&(e.node.componentId=a)}catch(e){(0,U.Lo)("handleTextToTemplate","Error importing component (e.g., sticker)",e)}}else if("WIDGET"===e.node.type){if(e.node.pluginData&&e.node.pluginData.pluginSvgPreviewUrl)try{let t=await fetch(e.node.pluginData.pluginSvgPreviewUrl).then(async e=>(e.ok||(0,U.Lo)("handleTextToTemplate","Error importing widget svg"),await e.text()));t&&(e.node.pluginData.pluginSvgPreviewData=t)}catch(e){(0,U.Lo)("handleTextToTemplate","Error importing widget",e)}if(e.node.pluginId){let t;try{t=await (0,tl.Ek)(ek.k_1,{pluginId:e.node.pluginId,orgId:o})}catch(e){(0,U.Lo)("handleTextToTemplate","Error getting plugin",e)}(null==t?void 0:t.status)==="loaded"&&(null==(n=t.data)?void 0:n.plugin)||(0,U.Lo)("handleTextToTemplate","Error getting plugin; plugin possibly not loaded yet");let a=(null==(s=null==(l=null==t?void 0:t.data)?void 0:l.plugin)?void 0:s.currentPluginVersionId)??"";a||(0,U.Lo)("handleTextToTemplate","Could not get latest plugin version ID"),e.node.pluginVersionId=a}}m.push(e)}if((null==r?void 0:r.trace)&&(_=r.trace,(0,U.Lo)("handleTextToTemplate","Trace data",{message:r.trace})),null==r?void 0:r.requestId){let t=r.requestId;!function(e,t,a,i,r){e7(a).then(t=>{(0,v.sx)("ai_prompt_builder_output_streaming",{fileKey:e,variantIndex:0,promptId:t,outputType:te(i),cortexRequestId:r,localOutputId:R.zl.get(tr)},{forwardToDatadog:!0})})}(a,0,e,"board",t),R.zl.set(ti,t)}if(i){(0,U.Lo)("handleTextToTemplate","Stream seems to be done.");break}}for(;m.length>0;)await u()}catch(e){throw e.trace=_,e}finally{td.l7.system("ai-add-template-commit",()=>es.vlL.commitPreview()),c.releaseLock()}return _}async function tu({prompt:e,visualType:t,signal:a,authInfo:i,ganttColor:r,ganttType:o}){let n=await eZ.Ay.figjam.createVisual({prompt:e,visualType:t},i);a.aborted||((null==n?void 0:n.requestId)&&R.zl.set(ti,n.requestId),(null==n?void 0:n.trace)&&(0,U.Lo)("handleTextToVisual","Trace data",{message:n.trace}),await el.Y5.onReady(),function(e,t,{ganttType:a=es.VIy.BASIC,ganttColor:i=th()}={}){switch(e){case"gantt":td.l7.user("generate-figjam-ai-gantt-chart",()=>es.$mk.generateFigjamAiGanttChart(t,a,i));return;case"orgchart":case"diagram":td.l7.user("generate-figjam-ai-flowchart",()=>es.$mk.generateFigjamAiFlowchart({type:"diagram"===t.type?es.vwB.DIAGRAM:es.vwB.ORG_CHART,direction:"horizontal"===t.direction?es.miP.HORIZONTAL:es.miP.VERTICAL,vertices:t.vertices,edges:t.edges},function(){let e=[es.QOd.PURPLE,es.QOd.BLUE,es.QOd.GREEN];return e[Math.floor(Math.random()*e.length)]}()));return;case"mindmap":td.l7.user("generate-figjam-ai-mindmap",()=>es.$mk.generateFigjamAiMindmap(t));return;case"timeline":td.l7.user("generate-figjam-ai-timeline",()=>es.$mk.generateFigjamAiTimeline(t,function(){let e=[es.Pls.BLUE,es.Pls.GREEN,es.Pls.PURPLE,es.Pls.RED,es.Pls.YELLOW];return e[Math.floor(Math.random()*e.length)]}()));return}}(t,n,{ganttColor:r,ganttType:o}))}function th(){let e=[es.sFD.BLUE,es.sFD.GREEN,es.sFD.PURPLE,es.sFD.RED,es.sFD.YELLOW];return e[Math.floor(Math.random()*e.length)]}var tp=a(41092);a(92592);var tf=((w=tf||{}).SUMMARIZE="sticky-summarization-error",w.CLUSTER="sticky-cluster-error",w.GENERATE="generate-error",w),tg=((T=tg||{}).Reload="reload",T.Trace="trace",T);let tw=(0,eL.D)((e,t)=>{let a={"sticky-summarization-error":{content_length_limit_exceeded:(0,H.t)("whiteboard.ai_summary.content_length_limit_exceeded_error"),figjam_summarize_out_of_date:(0,H.t)("whiteboard.ai_summary.out_of_date_error"),rate_limit_exceeded:(0,H.t)("whiteboard.ai_summary.rate_limit_exceeded_error"),ai_opt_out_error:(0,H.t)("whiteboard.ai.ai_opt_out_error"),generic:(0,H.t)("whiteboard.ai_summary.generic_error"),service_issue:(0,H.t)("whiteboard.ai.service_issue_error"),unsafe_or_harmful_content:(0,H.t)("whiteboard.ai.inappropriate_input_error"),offline:(0,H.t)("whiteboard.ai.offline_error"),unauthorized:(0,H.t)("whiteboard.ai_summary.generic_error")},"sticky-cluster-error":{content_length_limit_exceeded:(0,H.t)("whiteboard.ai_cluster.content_length_limit_exceeded_error"),figjam_cluster_out_of_date:(0,H.t)("whiteboard.ai_cluster.out_of_date_error"),rate_limit_exceeded:(0,H.t)("whiteboard.ai_cluster.rate_limit_exceeded_error"),ai_opt_out_error:(0,H.t)("whiteboard.ai.ai_opt_out_error"),generic:(0,H.t)("whiteboard.ai_cluster.generic_error"),service_issue:(0,H.t)("whiteboard.ai.service_issue_error"),unsafe_or_harmful_content:(0,H.t)("whiteboard.ai.inappropriate_input_error"),offline:(0,H.t)("whiteboard.ai.offline_error"),unauthorized:(0,H.t)("whiteboard.ai_cluster.generic_error")},"generate-error":{content_length_limit_exceeded:(0,H.t)("whiteboard.ai_generate.content_length_limit_exceeded_error"),rate_limit_exceeded:(0,H.t)("whiteboard.ai_generate.rate_limit_error"),ai_opt_out_error:(0,H.t)("whiteboard.ai.ai_opt_out_error"),generic:(0,H.t)("whiteboard.ai_generate.unknown_error"),service_issue:(0,H.t)("whiteboard.ai.service_issue_error"),unsafe_or_harmful_content:(0,H.t)("whiteboard.ai.inappropriate_input_error"),figjam_templates_out_of_date:(0,H.t)("whiteboard.ai_generate.out_of_date_error"),offline:(0,H.t)("whiteboard.ai.offline_error"),unauthorized:(0,H.t)("whiteboard.ai_generate.unknown_error")}},i="generic",r=!0;if(e instanceof tp.G1)switch(e.type){case"content_length_limit_exceeded":i="content_length_limit_exceeded";break;case"figjam_summarize_out_of_date":i="figjam_summarize_out_of_date";break;case"figjam_cluster_out_of_date":i="figjam_cluster_out_of_date";break;case"figjam_templates_out_of_date":i="figjam_templates_out_of_date";break;case"rate_limit_exceeded":i="rate_limit_exceeded";break;case"service_issue":i="service_issue";break;case"offline":i="offline",r=!1;break;case"unsafe_or_harmful_content":i="unsafe_or_harmful_content",r=!1;break;case"unauthorized":i="unauthorized",r=!1;break;case"figjam_visual_parsing_error":i="generic",r=!1;break;case"generic":if(429===e.data.status){i="rate_limit_exceeded";break}403===e.data.status&&(i="ai_opt_out_error")}let o=a[t],n=o[i]??o.generic;return{type:i,message:n,reportToSentry:r}});var tT=((E=tT||{}).NONE="none",E.TOP_BAR="top-bar",E.NEW_FILE="new-file",E);let tE="used_figjam_ai_generate",tN="used_figjam_ai_generate_modal_v2",tA=(0,ev.eU)(!1),tv=(0,ev.eU)(null,(e,t)=>{t(tA,!0),t(tO,void 0)}),ty=(0,ev.eU)(null,(e,t)=>{t(tP),t(tA,!1)}),tI=(0,ev.eU)(!1),tb=(0,ev.eU)(null,(e,t)=>{t(tP),t(tI,!0)}),tM=(0,ev.eU)(e=>e(tA)?"top-bar":(e(eQ)===eq.TRUE||e(tS))&&!e(tI)&&e(eM)===eI.NONE?"new-file":"none"),tP=(0,ev.eU)(null,(e,t)=>{t(tF),t(tS,!1),t(tO,void 0)});(0,ev.eU)(null,(e,t)=>{let a=e(tM);"top-bar"===a?t(ty):"new-file"===a&&t(tb)});let tR=(0,ev.eU)(null,(e,t)=>{e(tj).abort(),t(tj,new AbortController),t(tV,{status:to.NONE})});(0,ev.eU)(null,(e,t)=>{t(tP),t(tI,!1),t(tA,!1)});let tF=(0,ev.eU)(null,(e,t)=>{t(tR),t(tk,e0.ENTRY),t(tU,void 0),t(tG,th()),t(tx,es.VIy.BASIC)});(0,ev.eU)(null,(e,t)=>{t(tk,e0.PROMPT_BUILDER)});let tD=(0,ev.eU)(e0.ENTRY),tS=(0,ev.eU)(!1),tk=(0,ev.eU)(null,(e,t,a)=>{a===e0.PROMPT_BUILDER&&t(tS,!0),t(tD,a)});(0,ev.eU)(e=>e(tD));let tL=(0,ev.eU)(""),tO=(0,ev.eU)(void 0),tC=(0,ev.eU)(""),tU=(0,ev.eU)(void 0),tG=(0,ev.eU)(th()),tx=(0,ev.eU)(es.VIy.BASIC),tV=(0,ev.eU)({status:to.NONE}),tB=(0,eJ.Wh)(()=>(0,ev.eU)(!1));(0,ev.eU)(null,(e,t,a)=>{t(tB,a)});let tj=(0,ev.eU)(new AbortController),tH=(0,ev.eU)(null,async(e,t,{fileKey:a,prompt:i,stage:r,useCaseCategory:o,useCase:n,subtitle:l,entrypoint:s,jumpToNewLine:d,fromGenerateModalV2:_})=>{let c;if(null===a&&(0,U.$D)(x.e.FIGJAM_ENGAGEMENT,Error("No file key provided for FigJam AI Generate request")),!i)return{status:to.NONE};t(tr,e=>e+1),e((0,eW.r1)(tE)).data||eF.D.dispatch(eG.b({[tE]:!0}));let m=e((0,eW.r1)(tN)).data;_&&!m&&eF.D.dispatch(eG.b({[tN]:!0})),t(tR);let u=e(tj).signal,h={orgId:e(ez._s),teamId:e(eS.As)||null,fileKey:a,userId:e(eK.kS)||null};t(tV,{status:to.LOADING}),t(tU,o),t(tk,e0.PROMPT_BUILDER);let p="board";try{globalThis.AI_DEBUG_XML&&(0,P.kc)().figjam_text_to_template_debug?p="board":(p=await e3({prompt:i,signal:u,authInfo:h})||"board",(0,P.kc)().figjam_text_to_visual_timeline||"timeline"!==p||(p="gantt"),(!(0,P.kc)().figjam_text_to_visual_mindmap||!(0,P.kc)().figjam_mindmaps_entry_enable)&&"mindmap"===p&&(p="board"))}catch(d){let e=tw(d,tf.GENERATE);return c={status:to.ERROR,type:p,errorMessage:e.message,trace:d.trace},tt(a,0,1,i,"inappropriate",r,s,o,n,l),ta(a,e.message),e.reportToSentry&&(0,U.$D)("board"===p?x.e.FIGJAM_ENGAGEMENT:x.e.FIGJAM_CORE,d),t(tV,c),c}o&&(o===e8.FLOW_CHART?p="diagram":o===e8.GANTT_CHART?p="gantt":o===e8.ORG_CHART&&(p="orgchart"));let f=e(tC),g=f&&i.includes(f)?f:void 0;t(tC,""),tt(a,0,1,i,p,r,s,o,n,l,g);try{c=await e$(()=>e(ti)||"null",a,ex.AI,async()=>{let t;if("board"===p){let r=d||null,o=e(ez._s);t=await tm({prompt:i,signal:u,fileKey:a,authInfo:h,shouldJumpToNewLine:r,orgId:o})}else{let t=e(tx),a=e(tG),r=p;await tu({prompt:i,signal:u,visualType:r,authInfo:h,ganttColor:a,ganttType:t})}let r=e(ti);return!function(e,t,a,i,r){e7(a).then(t=>{(0,v.sx)("ai_prompt_builder_output_created",{fileKey:e,variantIndex:0,promptId:t,outputType:te(i),cortexRequestId:r,localOutputId:R.zl.get(tr)},{forwardToDatadog:!0})})}(a,0,i,p,r),{status:to.SUCCESS,type:p,trace:t}})}catch(e){if((null==e?void 0:e.name)==="AbortError")c={status:to.NONE};else{let t=tw(e,tf.GENERATE);c={status:to.ERROR,type:p,errorMessage:t.message,trace:e.trace},t.reportToSentry&&(0,U.$D)("board"===p?x.e.FIGJAM_ENGAGEMENT:x.e.FIGJAM_CORE,e),ta(a,t.message)}}return t(tV,c),c});(0,ev.eU)(null,(e,t,{prompt:a,stage:i,useCaseCategory:r,useCase:o,subtitle:n,entrypoint:l,jumpToNewLine:s,fromGenerateModalV2:d})=>{let _=e(eS.ze);if(null===_||0===_.length){(0,U.$D)(x.e.FIGJAM_ENGAGEMENT,Error("No file key found for loaded file to use for FigJam AI Generate request"));return}t(tH,{fileKey:_,prompt:a,stage:i,useCaseCategory:r,useCase:o,subtitle:n,entrypoint:l,jumpToNewLine:s,fromGenerateModalV2:d})});let t$=(0,ev.eU)(null,(e,t,{fileKey:a,prompt:i,stage:r,useCaseCategory:o,useCase:n,subtitle:l,entrypoint:s,jumpToNewLine:d,fromGenerateModalV2:_})=>{t(tH,{fileKey:a,prompt:i,stage:r,useCaseCategory:o,useCase:n,subtitle:l,entrypoint:s,jumpToNewLine:d,fromGenerateModalV2:_})});class tz{constructor(){this._isCanceled=!1,this._onCanceled=null,this._resolveCompletionPromise=()=>{},this._promise=new Promise(e=>{this._resolveCompletionPromise=e})}cancel(){this._isCanceled=!0,this._onCanceled&&this._onCanceled()}setOnCanceled(e){this._onCanceled=e}get isCanceled(){return this._isCanceled}done(){return this._resolveCompletionPromise()}waitForCompletion(){return this._promise}}let tW=null;var tK=a(49793),tJ=a(61060);async function tY(e,t,a,i,r){var o,n,l;let s=e.getState(),d=s.selectedView,_=d&&"fullscreen"===d.view;if(!_)return;(0,U.sC)(await eh.M4.fetchFile(t));let c=(0,ep.w2)((0,ep.i_)(s.theme.themePreference));mpGlobal.preconnect(mpGlobal.url({fileKey:t,role:"editor",initialBgColor:c,suppressDecodeErrors:!1,connectionType:i,tagForLogging:a===J.nT.DevHandoff?"dev_mode":void 0,forceViewOnly:tK.z4.getIsExtension()})),await el.Y5.loadAndStartFullscreenIfNecessary(),es.glU.setEditorType((0,J.xq)(a)),es.glU.setEditorTheme(s.theme.visibleTheme||"");let m=(await (r?(async()=>{let e=new O(()=>eN.getFileMetadata({fileKey:t})),a=await e.getResult();if(L(a))throw Error("Request was canceled");return a})():eN.getFileMetadata({fileKey:t}))).data.meta;if(!(_=(d=(s=e.getState()).selectedView)&&"fullscreen"===d.view))return;!function(e,t,a){var i,r;let o=JSON.stringify((null==(i=b.Ay.location.state)?void 0:i.previousSelectedView)||{}),n="fullscreen"===t.selectedView.view?null==(r=t.selectedView.trackingInfo)?void 0:r.source:"";(0,q.ds)("File Opened",e.key,t,{randomID:(0,e_.ds)(),prevView:o,source:n,authenticatedUserIds:t.authedUsers.orderedIds.filter(e=>{var a;return e!==(null==(a=t.user)?void 0:a.id)})}),"fullscreen"===t.selectedView.view&&(t.selectedView.editorType===J.nT.Design||t.selectedView.editorType===J.nT.DevHandoff)&&function(e,t,a,i,r={}){var o;let n=t===J.nT.DevHandoff?X:"Enter Design Mode",l={source:a,hasSeatForDevMode:(0,W.tn)(e),...r},s=null==(o=e.openFile)?void 0:o.key;(0,q.ds)(n,s,e,l,{forwardToDatadog:void 0}),(async()=>{if((0,P.Ay)().org_id&&(await (0,Y.hW)("exp_dev_mode_last_active_full_tracking")).get("enabled",!1)&&s&&"init"!==a){let e=n===X?Q.Mr.DEV_MODE_FILE_SEEN:Q.Mr.DESIGN_FILE_SEEN;Z.L.postRecentActivity({fileKey:s,activityType:e})}})()}(t,t.selectedView.editorType,"init")}({key:t},s),(0,$.b)((0,J.oD)(a)),function(e){var t;if(e!==J.nT.Design&&e!==J.nT.DevHandoff)return;let a=e===J.nT.DevHandoff?"dev_handoff":"design";null==(t=z.x4)||t.setItem("last-used-design-editor-type",a)}(a),l={sharedFontsList:(0,I.Mx)(m.shared_fonts),localizedToUnlocalized:[],renames:{family:{},style:{}},sources:[es.jXp.SHARED]},em.xK.time("updateFontListFileMetadata",()=>{l.sharedFontsList=(0,ed.F8)(l.sharedFontsList||[]),e.dispatch(et.nN(l)),es.vXe.updateFontList({list:l.sharedFontsList,localizedToUnlocalized:[]})}),e.dispatch(et.kP({needsUpgrade:m.needs_upgrade})),el.Y5.figFileLoaded(t),es.glU.openFileWithServerMetadata({metadata:{file_key:m.file_key,source_file_key:m.source_file_key},startInCommentsMode:!1,newFile:!0,selectedNodeId:null,fallbackStateGroupId:null,urlViewport:null,additionalTopPadding:null,mainComponentLink:!1,shouldConnectToMultiplayer:mpGlobal.shouldConnectToMultiplayer,preserveUrlNodeId:!1});let u=m.team;u&&e.dispatch(ei.yJ({team:u,userInitiated:!1}));let h=await eh.M4.fetchFile(t),p=e.getState(),f=p.folders[h.folder_id||""],g=p.teams[h.team_id||""],w=(0,G.SH)(p.userEduGracePeriods,h.team_id||""),T=p.repos[h.file_repo_id||""],E=p.fileByKey[h.source_file_key||""],N=(0,ef.UE)(h,{folder:f,team:g,repo:T,sourceFile:E,can_delete:!0,can_edit:!0,can_edit_canvas:!0,can_access_dev_mode_entry_point:!0,can_access_full_dev_mode:!0,can_manage:!0,can_view:!0,showEditButton:m.show_edit_button,hasEduGracePeriod:w.isInValidGracePeriod,isFavorited:!!(null==E?void 0:E.is_favorited)});(0,J.Nw)(a)&&(0,J.fP)(a,N.editorType)&&((0,U.x1)("new file","editor type mismatch",{requested:a,file:N.editorType}),a=(0,J.wN)(N.editorType)),e.dispatch(et.OB({file:N,fullscreenEditorType:a}));let A=m.current_team_user;A&&h.team_id&&e.dispatch(er.yJ({teamUsers:[A],teamId:h.team_id})),e.dispatch(et.QA({showEditButton:m.show_edit_button}));let v=!!(m.is_team_template&&(0,eo.LQ)(s));null==(o=y.eD)||o.setIsLibrary(!!m.last_published_at),null==(n=y.eD)||n.setIsTeamTemplate(!!v)}async function tq(e,t,a){e.dispatch(et.Y6({mode:a?eu.Oin.HIDE_UI:eu.Oin.OFF})),await el.Y5.loadAndStartFullscreenIfNecessary(),(0,ec.NT)(es.FAf.DESIGN),(0,P.kc)().ce_new_missing_fonts_logging&&(0,tJ.e8)();let i=e.getState().theme.visibleTheme;el.Y5.updateAppModel({themePreference:i}),es.glU.openEmptyFile((0,J.xq)(t))}function tQ(e){let t={};return e.folder_id&&(t.folder_id=e.folder_id),e.org_id&&(t.org_id=e.org_id),e.framePresetName&&(t.frame_preset_name=e.framePresetName),e.editorType&&(t.editor_type=e.editorType),e.fileName&&(t.name=e.fileName),e.localFileKey&&(t.localFileKey=e.localFileKey),e.team_id&&(t.team_id=e.team_id),e.figjamAiNewFileData&&(t.figjamAiNewFile_prompt=e.figjamAiNewFileData.prompt,t.figjamAiNewFile_useCaseCategory=e.figjamAiNewFileData.useCaseCategory,t.figjamAiNewFile_subtitle=e.figjamAiNewFileData.subtitle,t.figjamAiNewFile_entrypoint=e.figjamAiNewFileData.entrypoint),e.figjamMakeSomethingUseCase&&(t.figjam_make_something_use_case=e.figjamMakeSomethingUseCase),e.slidesTemplateHubFileId&&(t.slides_template_hub_file_id=e.slidesTemplateHubFileId),t}async function tZ(e,t,a,i,r){var o,n;let l;await tq(e,(0,J.wN)(t.editorType),i),r?(await r.onConnectNewFile(t),await (null==(o=r.session())?void 0:o.restoreAutosaveIfNeeded())):(0,U.Lo)("new file","failed to get autosave"),(t.nodeId||t.viewport)&&es.glU.restorePageAndViewportFromURL(t.nodeId??null,t.viewport??null);let s=t,d=()=>{var e,t;return(null==(e=null==r?void 0:r.fileCreationManager)?void 0:e.newFileInfo)&&(s=null==(t=null==r?void 0:r.fileCreationManager)?void 0:t.newFileInfo),s},_="slides"!==t.editorType&&(null==r?void 0:r.managerState)==="connected"&&B.yp&&!(0,M.w5)();if((0,P.kc)().ds_workspace_team_default_modes&&t.folder_id&&eA.getDefaultModes({folderId:t.folder_id}).then(e=>{let t=e.data.meta;for(let e of Object.keys(t))es.CWU.setExplicitVariableModeForSelection(e,{guid:t[e],collectionKey:e},!1)}),_){let e=0,i=performance.now();if(a.isCanceled)return{status:"canceled"};let r=new O(async()=>{e++;let t=tQ(d());return(await S.Ay.post("/api/files/create",t)).data});a.setOnCanceled(()=>r.cancelRequest());let o=await r.getResult();if(L(o))return{status:"canceled"};a.setOnCanceled(null);let n=Math.round(performance.now()-i);N.offlineFileCreated(e,n,t),l=o}else{(0,U.Lo)("new file","Offline file creation not supported",{editorType:t.editorType,autosaveState:null==r?void 0:r.managerState});let e=tQ(t);l=(await S.Ay.post("/api/files/create",e,{retryCount:tX})).data}let c=l.meta.fig_file;null==(n=y.eD)||n.setUrl({url:c.url,fileKey:c.key,oldLocalFileKey:null==r?void 0:r.fileKey});let m=null==r?void 0:r.fileCreationManager;m&&m.assignPendingRealFileKey(c.key),d(),s.fileName&&s.fileName!==c.name&&(e.dispatch(ee.yJ({file:{key:c.key,name:s.fileName},userInitiated:!0})),c.name=s.fileName);let u=function(e,t,a,i){let r=t.meta.fig_file,o=t.meta.team_user,n=t.meta.org_user;e(ee.yJ({file:r})),n&&e(ea.hZ({orgUsers:[n],orgId:n.org_id})),o&&e(er.yJ({teamUsers:[o],teamId:o.team_id}));let l=a?{uiTriggeredFrom:a.from,uiSelectedView:JSON.stringify(a.selectedView)}:{};return l.teamId=(null==o?void 0:o.team_id)||null,l.orgId=(null==n?void 0:n.org_id)||null,l.folderId=r.folder_id,l.authenticatedUserIds=i.authedUsers.orderedIds,l.offline=`${!navigator.onLine}`,(0,q.f5)("File Created",r,i,l),r.key}(e.dispatch,l,t.trackingInfo,e.getState());if("whiteboard"===t.editorType){if(t.figjamAiNewFileData){let e=(0,P.kc)().ai_generate_specific_prompts;R.zl.set(tv),R.zl.set(tL,t.figjamAiNewFileData.prompt),R.zl.set(t$,{fileKey:u,prompt:t.figjamAiNewFileData.prompt,useCaseCategory:t.figjamAiNewFileData.useCaseCategory,subtitle:t.figjamAiNewFileData.subtitle,stage:e4.GENERATE_MODE,entrypoint:t.figjamAiNewFileData.entrypoint,fromGenerateModalV2:e})}else t.figjamMakeSomethingUseCase&&R.zl.set(eM,t.figjamMakeSomethingUseCase)}return"slides"===t.editorType&&(0,P.kc)().piper&&(0,P.kc)().piper_community_templates&&t.slidesTemplateHubFileId&&R.zl.set(eC,{type:eU.Vf.TEMPLATE,libraryKey:t.slidesTemplateHubFileId,parentView:{type:eU.Vf.ALL}}),(0,U.Lo)("new file","Received file key for new file",{fileKey:u}),await tY(e,u,(0,J.wN)(t.editorType),"new-file",_),await (null==r?void 0:r.assignFileKeyForLocalFile(c.key)),t.callback&&t.callback(u),{status:"success"}}(e=>{e.fileCreationStarted=function(e){var t,a,i,r,o,n;(0,v.sx)("File Creation Start",{editorType:e.editorType,from:null==(t=e.trackingInfo)?void 0:t.from,selectedView:null==(i=null==(a=e.trackingInfo)?void 0:a.selectedView)?void 0:i.view,offline:!navigator.onLine,webLocksAvailable:B.yp}),(0,U.Lo)("new file","Creating a new file",{editorType:e.editorType,from:null==(r=e.trackingInfo)?void 0:r.from,selectedView:null==(n=null==(o=e.trackingInfo)?void 0:o.selectedView)?void 0:n.view})},e.offlineFileCreated=function(e,t,a){e>tX&&(async()=>{var i;let r=null==(i=(0,en.ZG)())?void 0:i.session(),o=r?await r.getNodeChangeCount().catch(()=>0):0,n=(0,en.GT)();(0,v.sx)("Offline File Creation",{editorType:a.editorType,requestDuration:t,requestAttempts:e,nodeChangeCount:o,hasChangedMetadata:null==n?void 0:n.hasChangedMetadata},{forwardToDatadog:!0})})().catch(()=>{})},e.fileCreationFailed=function(e,t,a,i,r){var o,n,l;let s=t instanceof S.Dr?t.status:void 0;(0,U.x1)("new file","failed to create new file",{msg:e,status:s,hasPersistedUserChanges:a});let d=Error(a?"failed to create new file with offline changes":"failed to create new file");d.cause=t,(0,U.$D)(x.e.SCENEGRAPH_AND_SYNC,d),(0,v.sx)("File Creation Failure",{editorType:r.editorType,msg:e,status:s,offline:!navigator.onLine,hasPersistedUserChanges:a,result:i,from:null==(o=r.trackingInfo)?void 0:o.from,selectedView:null==(l=null==(n=r.trackingInfo)?void 0:n.selectedView)?void 0:l.view},{forwardToDatadog:!0})}})(N||(N={}));let tX=2;function t0(e,t,a){let i;if(tW){(0,U.xi)("new file","File creation already in progress");return}let r=function(){if(tW)throw Error("File creation already in progress");return tW=new tz}();N.fileCreationStarted(t);let o=e.getState().user;if(o){let e=t.localFileKey??(0,A.r)(V.g);i=(0,en.mu)(e,o.id)}else(0,U.Lo)("Autosave","Not creating manager for logged out user");tZ(e,t,r,a,i).catch(e=>({status:"error",error:e})).then(async a=>{var r,n;if("canceled"===a.status)await (0,en.yn)();else if("error"===a.status){let{error:l}=a,s=(n=(0,H.t)("user_facing_error.new_document"),navigator.onLine?l.message?l.message:n:(0,H.t)("user_facing_error.offline")),d=!!await (null==(r=null==i?void 0:i.session())?void 0:r.hasPersistedUserChanges()),_=d?"show_banner":"exit_editor";if(N.fileCreationFailed(s,l,d,_,t),"show_banner"===_)(0,U.Lo)("new file","Leaving editor open because file has unsynced persisted changes."),e.dispatch(j.s.error(s)),e.dispatch(et.JM());else{if(o&&i){let e=i.fileKey;(0,A.T)(e)&&await (0,en.$3)(o.id,e)}await (0,en.yn)(),e.dispatch(j.s.error(s)),e.dispatch(K.$T({view:"recentFiles"})),y.eD&&(y.eD.showFileBrowser(s),y.eD.close({suppressReopening:!0,shouldForceClose:!0}))}t.callback&&t.callback(null)}}).finally(()=>{(function(){if(!tW)throw Error("File creation already in progress");tW.done(),tW=null})(),(0,U.Lo)("new file","finished creating new file")}),e.dispatch(K.$T({view:"fullscreen",fileKey:void 0,framePresetName:t.framePresetName,editorType:(0,J.wN)(t.editorType),canNavigateDesktopNewTab:t.allowOnDesktop,nodeId:t.nodeId,localFileName:t.fileName})),setTimeout(()=>(0,F.zo)(F.F_.CREATE_FILE),2e3)}function t1(e,t){var a;if(!y.eD)return;t.localFileKey||(t.localFileKey=(0,A.r)(V.g));let i={...tQ(t)},r=null==(a=e.getState().user)?void 0:a.id;r&&(i.fuid=r);let o=(0,C.lF)(i),n=new URL(`/file/new?${o}`,document.baseURI),l=t.trackingInfo?{...t.trackingInfo}:null;try{(null==l?void 0:l.selectedView)&&structuredClone(l.selectedView)}catch(e){(null==l?void 0:l.selectedView)&&(l.selectedView={view:l.selectedView.view})}let s={...t,trackingInfo:l,callback:void 0},d="desktopNewTab"===e.getState().selectedView.view;y.eD.createFile({url:n.href,newFileInfo:s,editorType:t.editorType,isFromNewTabPage:d}).then(({fileKey:e})=>{t.callback&&t.callback(e)}).catch(e=>{console.error(e)})}},42830:(e,t,a)=>{a.d(t,{o:()=>o});var i=a(86759);let r=null;async function o(){return r||(await (0,i.k0)("https://accounts.google.com/gsi/client",{cors:!1,waitForCondition:()=>"google"in window}),r=window.google)}},24857:(e,t,a)=>{a.d(t,{S:()=>d,f:()=>s});var i=a(11855),r=a(99737),o=a(91388),n=a(79453),l=a(28467);function s(e,t=!0){let a=(0,i.useMemo)(()=>{var t;return(null==(t=e.data)?void 0:t.map(e=>({key:e.key})))??[]},[e]),l=(0,r.p)(n.sMs,a,{enabled:a.length>0});return(0,i.useMemo)(()=>(function(e,t,a=!0){if("loaded"!==e.status)return e;let i={},r=!1,n=null;return(t.forEach(e=>{var t;if("loading"===e.result.status||"disabled"===e.result.status){r=!0;return}if("errors"===e.result.status){n=e.result.errors;return}i[e.args.key]=(null==(t=e.result.data.file)?void 0:t.hasPermission)??!1}),null!=n)?a?e:o.Qw.error(n):r?a?e:o.Qw.loading():o.Qw.loaded(e.data.filter(e=>i[e.key]))})(e,l,t),[l,e,t])}function d(e){let t=(0,l.usePermissionsState)();return(0,i.useMemo)(()=>{let a=(0,l.canViewFile)(e,t);return(0,r.gB)({result:a})},[e,t])}},20331:(e,t,a)=>{a.d(t,{R_:()=>y,w5:()=>v});var i=a(88823),r=a.n(i),o=a(11617),n=a(98977),l=a(66712),s=a(10004),d=a(208),_=a(62275),c=a(88022),m=a(49793),u=a(49719),h=a(47935),p=a(29594),f=a(17333),g=a(63706),w=!1;let T=null,E=null,N=null,A=577==a.j?["mousemove","mousedown","keydown","touchstart","touchmove","wheel"]:null;function v(){return w}function y(e){let{user_data:t,idle_timeout_duration_in_secs:a,idle_timeout_last_active_at:i,idle_timeout_org_name:v,frame_context:y}=(0,l.Ay)();t&&a&&i&&v&&!w&&function(e,t,a,i,v,y){if((0,g.Q1)()||(0,g.Ji)()||g.Ay.isIpadNative)return;let I=`last-active-at-${e.email}`,b="idle_timeout_last_active_at_change",M=(0,o.GZ)(),P=M&&"embed"===v,R=M&&"integration"===v,F=.05*t,D=Math.min(60,t/2),S=new s.P,k=e=>{localStorage.setItem(I,e.toString()),S.sendToAllTabs(b)};k(a);let L=()=>{document.hasFocus()&&d.Ay.post(`/api/user/${e.id}/idle_timeout_last_active_at`,{is_embed:M.toString()&&!m.z4.getIsExtension()}).then(e=>{let t=e.data.meta.idle_timeout_last_active_at;t&&k(t)}).catch(e=>{401===e.status&&C()})},O=()=>{var e;return!!y&&(null==(e=y.getState().modalShown)?void 0:e.type)===p.xn},C=()=>{if(y&&(null==y?void 0:y.getState().authedUsers.orderedIds.length)===1&&(0,c.Pg)(),P)n.Ay.reload("idleSessionTimeout-embed");else if(R){let{pathname:e,search:t}=n.Ay.location,a=`${e}${t}&integration_host=msft`;window.location.replace(a)}else m.z4.getIsExtension()&&(0,l.kc)().dt_dev_mode_vscode_idle_timeout?(0,u.$g)():n.Ay.redirect(`/idle_timeout?fuid=${e.id}&redirect_uri=${encodeURIComponent(window.location.href)}`)},U=()=>Math.floor(Date.now()/1e3);N&&A.forEach(e=>{document.removeEventListener(e,N)}),N=r()(L,1e3*F,{trailing:!1,leading:!0}),A.forEach(e=>{document.addEventListener(e,N)});let G=()=>{E&&clearTimeout(E),T&&clearTimeout(T),!O()||document.hasFocus()||f.eD||null==y||y.dispatch(_.ES(p.eN));let a=parseInt(localStorage.getItem(I))+t-U();T=setTimeout(()=>{h.N.getIdleTimeoutPrecheck({fuid:e.id}).then(e=>{let a=e.data.meta.idle_timeout_last_active_at;a&&a+t>=U()?k(a):C()}).catch(e=>{C()})},1e3*a),P||(E=setTimeout(()=>{O()||null==y||y.dispatch(_.to({type:p.eN,data:{orgName:i,duration:t,onHide:()=>{L()}}}))},1e3*(a-D)))};S.register(b,()=>{G()}),G(),w=!0}(t,a,i,v,null==y?void 0:y.type,e)}},785:(e,t,a)=>{let i;a.d(t,{qr:()=>o});var r=((i=r||{}).MINUTES="minutes",i.HOURS="hours",i.DAYS="days",i);function o(e){return e<3600?[e/60,"minutes"]:e<86400?[e/3600,"hours"]:e%86400==0?[e/86400,"days"]:[e/3600,"hours"]}}}]);

//# debugId=c2377d34-1ec1-5289-9e38-23337e155386

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/59edcf80d2b9f7fd441113766edde5a49faad2b8/945-061821a541c8e7da.min.js.map