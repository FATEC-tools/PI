"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="55ef08cf-8370-5680-aa50-43b097800b5e")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5099],{24973:(e,t,l)=>{l.d(t,{Mf:()=>n,vR:()=>a,xR:()=>d});let a="tab_group--tabs--ChhR5",n="tab_group--tab--j43X-",d="tab_group--selectedTab--dwZ1b tab_group--tab--j43X-"},706638:(e,t,l)=>{let a;l.d(t,{P:()=>D,v:()=>O});var n=l(411855),d=l(188507),s=l(539321);if(443==l.j)var o=l(395096);var r=l(776250),i=l(358145),c=l(395900),u=l(268537),m=l(493323),f=l(135876),p=l(827586),g=l(32863),E=l(574176),b=l(939863),v=l(738269),h=l(852800),C=l(15859),y=l(318812),k=l(29680),N=l(463592),I=l(103271),_=l(406158),P=l(771e3),x=l(780634);if(443==l.j)var T=l(949207);if(443==l.j)var S=l(156238);if(443==l.j)var M=l(432023);var O=((a=O||{}).LOADED="post-to-feed-view-loaded",a.SELECT_NODE="post-to-feed-select-node",a);function F(e){return n.createElement("div",{className:null!==e.isSelectedIdx?x.El:x.Vs,onClick:e.onClick,role:"button",tabIndex:0,ref:t=>{t&&e.observe(t)},"data-observer-guid":e.node.guid},n.createElement("div",{className:x.h3,style:{backgroundColor:e.backgroundColor}},n.createElement(f.x,{isLoading:!e.thumbnailUrl},()=>n.createElement("img",{className:x.xn,src:e.thumbnailUrl,alt:"",draggable:!1}))),n.createElement("div",{className:x.JO},n.createElement("div",{className:x.qp},e.node.name)),null!==e.isSelectedIdx&&1!==e.totalNumSelected&&n.createElement("div",{className:x.Jx},e.isSelectedIdx+1))}function w(e){let{toggleSelectNode:t}=e,l=(e.pageNode&&(0,s.colorToHex)(e.pageNode.backgroundColor))??"",[a,d]=n.useState(!1),o=n.useCallback(a=>{t(a,{pageId:e.pageNode.guid,pageBackgroundColor:l})},[t,e.pageNode.guid,l]);return n.createElement("div",{className:x.RW},e.showCollapsibleHeader&&n.createElement("div",{className:x.Vr,onClick:()=>d(e=>!e),role:"button",tabIndex:0},a?n.createElement(E.B,{svg:M.A,className:x.Rq}):n.createElement(E.B,{svg:T.A,className:x.Rq}),e.pageNode.name,"\xa0",n.createElement("span",{className:x.Du},"\xb7 ",e.nodes.length)),!a&&n.createElement("div",{className:x.Mc},e.nodes.map(t=>{var a,d,s;let r=(null==(a=e.selectedNodeGuids)?void 0:a.indexOf(t.guid))??null;return n.createElement(F,{key:`node-${t.guid}`,node:t,thumbnailUrl:(null==(d=e.thumbnailByGuid[t.guid])?void 0:d.url)??"",backgroundColor:l,isSelectedIdx:-1===r?null:r,onClick:()=>o(t.guid),totalNumSelected:(null==(s=e.selectedNodeGuids)?void 0:s.length)??null,observe:e.observe})})))}let K="feed-post-page-selector-menu";function D(){let e=n.useCallback((e,t)=>{let l=window.parent;window.self.origin===l.origin&&l&&l.postMessage({type:e,data:t})},[]),t=n.useRef(new c.jk("feed_post_to_file_load",{}));n.useEffect(()=>{t.current.start()},[]);let l=(0,k.aV)(),a=(0,k.eY)(),s=(0,d.d4)(e=>{var t;return null==(t=e.openFile)?void 0:t.key});n.useEffect(()=>{if(!l){t.current.stop();let l=t.current.getElapsedTime();(0,r.sx)("team_feed.post_from_file.file_load",{elapsedMs:l,fileKey:s}),e("post-to-feed-view-loaded",!0)}},[l,e,s]);let f=(0,d.d4)(e=>e.mirror.appModel.pagesList),T=n.useMemo(()=>f.reduce((e,t)=>({...e,[t.nodeId]:a.get(t.nodeId)}),{}),[f,a]),M=(0,d.wA)(),O=n.useMemo(()=>Object.values(T).flatMap(e=>e?e.uiOrderedChildren.map(t=>{let l=a.get(t);return l&&("FRAME"===l.type||"SECTION"===l.type)?{...l,pageId:e.guid,name:null==l?void 0:l.name}:null}).filter(e=>e):[]).filter(e=>null!==e),[T,a]),F=n.useMemo(()=>{let e={};for(let t of O)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[O]),D=n.useMemo(()=>new N.Ef(O,{keys:["name"]}),[O]),[R,j]=n.useState(""),[A,U]=n.useState(null),[B]=(0,o.A)(R,200),L=n.useCallback(e=>{U(D.search(e))},[D]),Y=n.useMemo(()=>{if(null===A)return null;let e={};for(let t of A)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[A]);n.useEffect(()=>{""!==B&&L(B)},[B,L]);let Z=(0,y.U)(),q=n.useRef(null),[z,G]=n.useState(null);n.useEffect(()=>{if(z||!a||!F||0===Object.keys(F).length)return;let e=a.get(Object.keys(F)[0]);e&&G(e)},[z,F,a]);let[H,J]=n.useState({}),[V,W]=n.useState([]),$=(0,i.Z)(V),X=n.useRef(null),[Q,ee]=n.useState([]),et=n.useCallback(e=>{let t=[];e.forEach(e=>{var l;if(e.isIntersecting&&e.target instanceof HTMLElement){let a=null==(l=e.target.dataset)?void 0:l.observerGuid;a&&t.push(a)}}),ee(t)},[]),el=n.useMemo(()=>new IntersectionObserver(et,{threshold:[.25]}),[et]),ea=n.useCallback(e=>{el&&el.observe(e)},[el]),[en,ed]=n.useState({});n.useEffect(()=>{if(0===Q.length)return;let e=Q.filter(e=>!en[e]);0!==e.length&&(0,C.Jr)().loadAllImagesUnder(e,h.MoD.NON_ANIMATED_ONLY,"feed.postFromFile").then(()=>{e.forEach(e=>{setTimeout(()=>{ed(t=>{if(t[e])return t;let l=(0,_.BO)(e);return{...t,[e]:{url:URL.createObjectURL(new Blob([l])),data:l}}})},0)})})},[Q,en]),n.useEffect(()=>{V!==$&&e("post-to-feed-select-node",V.map(e=>({guid:e,thumbnail:en[e].data,backgroundColor:H[e]})))},[$,V,e,en,H]);let es=n.useCallback((e,t)=>{en[e]&&(J(l=>t.pageBackgroundColor?{...l,[e]:t.pageBackgroundColor}:l),W(t=>t.includes(e)?t.filter(t=>e!==t):t.length>=I.e3?t:[...t,e]))},[en]);return F&&0===Object.keys(F).length?n.createElement("div",{className:x.se},(0,b.t)("fig_feed.no_top_level_nodes")):z?n.createElement("div",{className:x.kL},n.createElement("div",{className:x.Y},n.createElement(g.IW,{query:R,className:x.ON,onChange:j,clearSearch:()=>{j(""),U(null)},focusOnMount:!1,iconClassName:x.qc,placeholder:(0,b.t)("fig_feed.search_frames")}),""===R&&n.createElement(n.Fragment,null,n.createElement("div",{role:"button",ref:q,onClick:()=>{(null==Z?void 0:Z.type)===K?M(v.oB()):M(v.j7({type:K}))},tabIndex:0,className:x.YZ},n.createElement("div",null,z.name),n.createElement(E.B,{svg:S.A,width:"8px",autosize:!0})),q.current&&(null==Z?void 0:Z.type)===K&&n.createElement(P.Cf,{showPoint:!1,targetRect:q.current.getBoundingClientRect(),propagateCloseClick:!0},Object.keys(F).map(e=>n.createElement(u.W.CheckableOption,{key:e,onClick:()=>G(T[e]),checked:z.guid===e},T[e].name))))),n.createElement(p.P,{hideScrollbar:!0,className:x.jG,innerClassName:x.hu,scrollContainerRef:X},""===R&&n.createElement(w,{pageNode:z,nodes:F[z.guid]||[],thumbnailByGuid:en,selectedNodeGuids:V,toggleSelectNode:es,observe:ea}),""!==R&&(null===Y?n.createElement("div",{className:x.Do},n.createElement(m.kt,{size:"large"})):Object.entries(Y).length>0?Object.entries(Y).map(([e,t])=>n.createElement(w,{key:e,pageNode:T[e],nodes:t,thumbnailByGuid:en,selectedNodeGuids:V,toggleSelectNode:es,showCollapsibleHeader:!0,observe:ea})):n.createElement("div",{className:x.Lp},n.createElement("div",null,n.createElement(b.Tx,{id:"fig_feed.no_frames_matching",searchQuery:n.createElement(n.Fragment,null,n.createElement("span",{className:x.ZF},R))})))))):null}},498792:(e,t,l)=>{l.r(t),l.d(t,{EditFeedPostModal:()=>Z});var a=l(411855),n=l(188507),d=l(629019),s=l.n(d),o=l(776250),r=l(609494),i=l(966712),c=l(498750),u=l(499737),m=l(27087),f=l(448169),p=l(946689),g=l(493323),E=l(881388),b=l(939863),v=l(392592),h=l(507877),C=l(662275),y=l(654034),k=l(694687),N=l(860178),I=l(279453),_=l(204279),P=l(531827),x=l(28588),T=l(103271),S=l(49218),M=l(588282),O=l(126674),F=l(679736),w=l(406158),K=l(301799),D=l(583630),R=l(660040),j=l(563288),A=l(160156),U=l(740645),B=l(782680),L=l(988898),Y=l(470400);function Z(e){let t=(0,n.wA)(),l=a.useCallback(()=>{t(C.Ce())},[t]),d=a.createElement(b.Tx,{id:"fig_feed.edit_post"}),s=e.feedPostUuid;!s&&e.feedPostThreadId&&(s=(0,M.gk)(e.feedPostThreadId));let o=(0,u.Rs)(I.FHz,{publicUuid:s},{enabled:!e.preloadedFeedPost&&!!s}),r=a.useMemo(()=>e.preloadedFeedPost?e.preloadedFeedPost:"loaded"===o.status?o.data.feedPost:null,[e.preloadedFeedPost,o]);return a.createElement(S.hZ,{header:a.createElement("div",{className:Y.Hc},d),onClose:l,maxWidth:S.Fo,disableFixedTop:!0,closeOnEsc:!0},r?a.createElement(q,{onSubmitSuccess:e.onSubmitSuccess,entryPoint:e.entryPoint,lockedFileKey:e.lockedFileKey,feedPost:r}):a.createElement("div",{className:Y._5},a.createElement(g.kt,{size:"large"})))}function q(e){var t;let l=(0,n.wA)(),d=(0,k.sZ)(),u=(0,N.iZ)(),[I,S]=a.useState(!0),[M,Z]=a.useState(!1),[q,z]=a.useState(!1),G=(0,j.e3)(e.feedPost),H=e.feedPost.publicUuid,J=a.useMemo(()=>e.feedPost.content.map(e=>JSON.parse(e)),[e.feedPost]),[V,W]=a.useState(J.reduce((e,t)=>{if(t.type!==T.cM.NODE)return e;e.fileKey=t.fileKey;let l=t.nodeId;return e.nodeIds.push(l),e},{fileKey:e.feedPost.fileKey||"",nodeIds:[]})),$=a.useMemo(()=>{let e=J.find(e=>e.type===T.cM.PROTOTYPE);return e?{fileKey:e.fileKey,pageId:e.pageId,startingNodeId:e.startingNodeId}:null},[J]),[X,Q]=a.useState(0),ee=a.useCallback(()=>{l(C.Ce())},[l]),et=a.useCallback(()=>{l((0,C.to)({type:B.h,data:{onConfirm:ee},showModalsBeneath:!0}))},[l,ee]),el=e.lockedFileKey||(null==V?void 0:V.fileKey)||(null==$?void 0:$.fileKey);a.useEffect(()=>{let t={entryPoint:e.entryPoint};el&&(t.fileKey=el),(0,o.sx)("Team Feed Edit Post Modal Opened",t)},[e.entryPoint,el]);let ea=a.useCallback((e,t,a)=>{if(t){l(C.Ce());return}let n={text:(0,b.t)("fig_feed.view_post"),action:()=>{l(h.V3({url:(0,O.Kc)(d.id,{uuid:e})}))}};l(v.F.enqueue({message:(0,b.t)("fig_feed.post_edited"),button:a?n:void 0})),l(C.Ce())},[l,d]),[en,ed]=a.useState(J.map(e=>{let t=(0,w.EU)(e),l=(0,T.aT)(e)&&!!e.hasPreviousEditPreview,a={...e,copiedToS3:e.type===T.cM.NODE||e.type===T.cM.PROTOTYPE,shouldBlockEditPreview:l&&!t};return{displayContentItem:a,processedContentItem:Promise.resolve(a)}})),es=a.useMemo(()=>new Set(en.map(e=>e.displayContentItem.type===T.cM.NODE?e.displayContentItem.nodeId:null).filter(e=>null!==e)),[en]);a.useEffect(()=>{(0,K.sr)(V,es,ed,null==d?void 0:d.id)},[V,es,ed,null==d?void 0:d.id]);let eo=a.useCallback(e=>{let t=(0,A.K1)(en[X].displayContentItem);Q(e.findIndex(e=>(0,A.K1)(e)===t));let l=[];e.forEach(e=>{let t=(0,A.K1)(e),a=en.find(e=>(0,A.K1)(e.displayContentItem)===t);a?l.push(a):console.error("Expected to have a matchedPendingItem")}),ed(l)},[en,X]),er=a.useCallback(e=>{Q(en.findIndex(t=>(0,A.K1)(t.displayContentItem)===e))},[en]),{setContentPreview:ei,snapshotStates:ec}=(0,K.eh)(en,ed),{onSubmitSuccess:eu}=e,em=a.useCallback((t,a)=>{m.Ay.put(`/api/feed_posts/${H}`,t).then(t=>{ea(t.data.meta.public_uuid,a,e.entryPoint===F.M2.FILE),a&&l(v.F.enqueue({message:(0,b.t)("fig_feed.post_submission_pending")})),eu&&eu(a)}).catch(()=>{l(E.s.error((0,b.t)("fig_feed.error_on_feed_post_creation"))),S(!1)})},[l,ea,eu,H,e.entryPoint]),[ef,ep]=a.useState(e.feedPost.title||""),[eg,eE]=a.useState((0,y.o8)(e.feedPost.descriptionMeta)),eb=a.useMemo(()=>({library:new P.M8(d.id)}),[d]);a.useEffect(()=>{S(ef.trim().length>R.Y||(0,r._Z)(eg).length>R.e||0===en.length)},[ef,eg,en.length]);let ev=async t=>{if(!d||I)return;null==t||t.preventDefault(),S(!0);let a={description_meta:eg,org_id:d.id},n=(0,r._Z)(eg);a.content=await (0,w.pj)(l,en,el??"",ef),(0,o.sx)("team_feed_content_awaited",{payloadContent:JSON.stringify(a.content)},{logFromProber:!0});let s=a.content.some(e=>e.pending);ef?a.title=ef:a.title=n.length>0?n.slice(0,40)+"\u2026":(0,b.t)("fig_feed.untitled_post"),el&&(a.attached_file_key=el),em(a,s),(0,o.sx)("Team Feed Post Edited",{fileKey:el,entryPoint:e.entryPoint,text:n,numContentItems:a.content.length,contentItemTypes:a.content.map(e=>e.type)},{forwardToDatadog:!0})},eh=a.useCallback((e,t)=>{if(!d)return;let a=Array.from(e);if(0===a.length)return;let n=(0,_.KT)(a,en.length,T.e3,T.bB,e=>{l(v.F.enqueue({message:(0,U.getUploadErrorMessage)(e)}))},en.map(e=>e.fileIdentifier)).map(e=>{let t=(0,_.Fn)(e);if(x.xp.includes(e.type))return(0,w.zr)(t,e);if(x.VY.includes(e.type))return(0,w.X2)(t,H,d.id,e);throw Error("unexpected file type")}),s=void 0!==t?t:en.length;ed(e=>[...e.slice(0,s),...n,...e.slice(s)]),Q(s)},[l,d,H,en]),eC=a.useCallback((e,t)=>()=>{var l;let a=(null==(l=e.current)?void 0:l.files)||null;null!==a&&0!==a.length&&(eh(a,t),e.current&&(e.current.value=""))},[eh]),ey=a.useCallback(e=>{let t=Math.min(e,Math.max(0,en.length-2)),l=en[e];if((0,w.AK)(l),ed(t=>t.filter((t,l)=>l!==e)),l.displayContentItem.type===T.cM.NODE){let e=l.displayContentItem.nodeId;W(t=>{if(t){let l=t.nodeIds.filter(t=>t!==e),a=t.nodeThumbnails,n=a&&l.reduce((e,t)=>(e[t]=a[t],e),{});return{...t,nodeIds:l,nodeThumbnails:n}}return null})}Q(t)},[en]),ek=a.useCallback((e,t)=>{eh(e.files,t),z(!1)},[eh]),eN=a.useRef(null),eI=!!(null==(t=null==V?void 0:V.nodeIds)?void 0:t.length),{openPostFromFileModal:e_,attachedFileData:eP}=(0,K.Ld)({setLinkedFileNodeInfo:W,numUserContentItems:en.length,hasNodeContent:eI,parentModalRef:eN,attachedFileKey:el,lockedFileKey:e.lockedFileKey,currentOrgId:null==d?void 0:d.id}),ex=a.useCallback(()=>{let t=en.map(e=>e.displayContentItem);return a.createElement(f.Y,{className:s()(Y.xe,q&&Y.w8),isDragTarget:()=>!0,onTargetDragEnter:()=>z(!0),onTargetDragLeave:()=>z(!1),onTargetDrop:e=>ek(e)},a.createElement(A.Zo,{contentItems:t,staticContent:!0,scrollable:!1,deleteItemAtIdx:M?void 0:ey,pageBackgroundColor:e.feedPost.backgroundColor??void 0,onReorderCallback:M?void 0:eo,shouldScrollToIndex:null,selectedIdx:X,setSelectedIdx:Q,onFileInputChange:eC,setSelectedContent:er,snapshotStates:ec,setContentPreview:ei,openPostFromFileModal:e_,attachedFile:eP,dragging:q,mode:"edit"}))},[e.feedPost,q,eo,ey,M,en,ek,X,eC,er,ec,ei,e_,eP]),eT=a.useCallback(e=>{e.keyCode===c.Uz.ESCAPE&&ee()},[ee]);return d&&u&&(0,i.kc)().xr_debounce_threshold?a.createElement("div",{className:Y.RO,onKeyDown:eT,role:"textbox",tabIndex:0,ref:eN},a.createElement("div",{className:Y.q3},ex(),d&&u?a.createElement("div",{className:Y.DA},a.createElement(D.FeedPostUnifiedComposer,{user:u,currentOrgId:d.id,autofocus:!0,mentionables:eb,onSubmit:I?void 0:ev,submitOnEnter:!1,hideSubmitButton:!0,description:eg,updateDescription:eE,title:ef,updateTitle:ep,displayDecoratorsDownwards:!0,minimized:!1,readOnly:M,editableTypeaheadClass:L.up,openPostFromFileModal:()=>e_({skipFrameSelection:!eI}),fileData:eP,lockFileAddition:en.length>=T.e3,parentRef:eN,canUnlinkFile:!eI&&!e.lockedFileKey,unlinkFile:()=>W(null)})):null),a.createElement("div",{className:Y.CQ},a.createElement("div",{className:Y._f},a.createElement("div",{className:Y.oW},a.createElement("div",{className:Y.Ru},a.createElement(b.Tx,{id:"fig_feed.post_to"})),a.createElement("div",{className:Y.Ev},a.createElement("div",{className:Y.oj},a.createElement(j.lO,{containerInfo:G,withoutTooltip:!0}),a.createElement("div",{className:Y.JT},G.name))))),a.createElement("div",{className:Y.UD},a.createElement(p.nR,{onClick:e=>{e.stopPropagation(),et()}},a.createElement(b.Tx,{id:"fig_feed.discard_edit"})),a.createElement(p.$$,{onClick:e=>{if(!M)return Z(!0),ev(e).finally(()=>{Z(!1)})},disabled:I,dataTestId:"feed-post-post",className:M?Y.zb:Y.pb},M&&a.createElement("div",{className:Y.YI},a.createElement(g.kt,{shouldMatchTextColor:!0,size:"medium"})),M?a.createElement(b.Tx,{id:"fig_feed.saving"}):a.createElement(b.Tx,{id:"general.save"}))))):null}}}]);

//# debugId=55ef08cf-8370-5680-aa50-43b097800b5e

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/95dfd14aa7f781083e33d36c521a587033fa64ec/team_feed-414675423e65bff5.min.js.map